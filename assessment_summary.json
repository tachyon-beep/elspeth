{
  "generated": "2025-10-07T00:43:02Z",
  "current": {
    "python_files": 53,
    "loc": 7503,
    "entry_points": [
      "src/elspeth/cli.py",
      "Makefile",
      "scripts/bootstrap.sh"
    ],
    "architecture": [
      "ExperimentOrchestrator with middleware-aware runner",
      "Plugin registries for datasources/llms/outputs/metrics",
      "Artifact pipeline enforcing sink dependencies",
      "Prompt engine with pack support",
      "Extensive pytest suite"
    ],
    "dependencies": {
      "core": [
        "openai>=1.12.0",
        "azure-identity",
        "azure-storage-blob",
        "pandas",
        "pyyaml",
        "jinja2",
        "jsonschema",
        "requests"
      ],
      "optional": [
        "azureml-core",
        "scipy",
        "pingouin",
        "statsmodels",
        "openpyxl"
      ]
    }
  },
  "legacy": {
    "python_files": 3,
    "loc": 3565,
    "entry_points": [
      "old/main.py"
    ],
    "architecture": [
      "Monolithic CLI with direct Azure OpenAI usage",
      "Experiment suite loader using jsonschema",
      "StatsAnalyzer performing Bayesian and frequentist tests"
    ],
    "dependencies": [
      "openai",
      "azureml",
      "jsonschema",
      "pandas",
      "numpy",
      "scipy",
      "pingouin",
      "statsmodels",
      "sklearn",
      "matplotlib",
      "requests",
      "yaml"
    ]
  },
  "differences": {
    "added_features": [
      "Artifact dependency pipeline",
      "LLM middleware registry",
      "Prompt packs and suite defaults",
      "Adaptive rate limiting and checkpoint resume",
      "Extensive automated tests"
    ],
    "removed_features": [
      "Heuristic early-stop hook",
      "Legacy plotting/report generation"
    ],
    "modified_features": [
      "Metrics/statistics reimplemented as plugins",
      "Configuration validation centralised in elspeth.core.validation",
      "Output sinks refactored into modular plugins"
    ]
  },
  "risks": [
    {
      "id": "single_run_plugins",
      "description": "Single-run orchestrator ignores configured row/aggregation plugins.",
      "reference": "src/elspeth/core/orchestrator.py:55"
    },
    {
      "id": "azure_middleware_default",
      "description": "Azure middleware aborts when run context is unavailable unless explicitly disabled.",
      "reference": "src/elspeth/plugins/llms/middleware_azure.py:60"
    },
    {
      "id": "retry_visibility",
      "description": "Retry loop re-raises final exception without additional context.",
      "reference": "src/elspeth/core/experiments/runner.py:326"
    }
  ],
  "recommendations": [
    "Instantiate plugin definitions for single-run mode.",
    "Relax Azure middleware defaults for non-Azure environments.",
    "Publish migration guide covering prompt packs and artifact pipeline.",
    "Reintroduce optional early-stop controls as plugins or middleware.",
    "Document live repository sink configuration and credential handling."
  ]
}
