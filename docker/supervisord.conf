[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

[program:sidecar-daemon]
command=/usr/local/bin/elspeth-sidecar --config /etc/elspeth/sidecar.toml
user=sidecar
autostart=true
autorestart=true
priority=10
stdout_logfile=/var/log/supervisor/sidecar-stdout.log
stderr_logfile=/var/log/supervisor/sidecar-stderr.log
environment=RUST_LOG="info"

[program:orchestrator]
command=/opt/venv/bin/python -m elspeth.cli %(ENV_ORCHESTRATOR_ARGS)s
user=appuser
autostart=false
autorestart=false
priority=20
stdout_logfile=/var/log/supervisor/orchestrator-stdout.log
stderr_logfile=/var/log/supervisor/orchestrator-stderr.log
environment=PATH="/opt/venv/bin:%(ENV_PATH)s",PYTHONUNBUFFERED="1"
; Orchestrator depends on sidecar daemon being ready
depends_on=sidecar-daemon
startsecs=0

; Note: Plugin workers are spawned on-demand by the orchestrator
; via subprocess.Popen with sudo -u appplugin, not managed by supervisord
