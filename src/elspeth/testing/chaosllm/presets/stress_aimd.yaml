# ChaosLLM Preset: stress_aimd
# Purpose: Specifically stress the AIMD throttle with frequent rate limits and bursts.
# Use when: Testing AIMD throttle recovery, backoff behavior, throughput under stress.

server:
  host: "127.0.0.1"
  port: 8000
  workers: 4

metrics:
  database: "file:chaosllm-metrics?mode=memory&cache=shared"
  timeseries_bucket_sec: 1

response:
  mode: random
  random:
    min_words: 10
    max_words: 50
    vocabulary: english

latency:
  base_ms: 30
  jitter_ms: 15

error_injection:
  # High rate limits to trigger AIMD
  rate_limit_pct: 15.0
  capacity_529_pct: 5.0
  service_unavailable_pct: 2.0
  retry_after_sec: [1, 3]

  # Some server errors
  internal_error_pct: 0.5
  bad_gateway_pct: 0.2
  gateway_timeout_pct: 0.3

  # No client errors
  forbidden_pct: 0.0
  not_found_pct: 0.0

  # No connection-level failures (focus on HTTP errors for AIMD)
  timeout_pct: 0.0
  timeout_sec: [30, 60]
  connection_reset_pct: 0.0
  slow_response_pct: 0.5
  slow_response_sec: [5, 10]

  # No malformed responses (focus on rate limiting)
  invalid_json_pct: 0.0
  truncated_pct: 0.0
  empty_body_pct: 0.0
  missing_fields_pct: 0.0
  wrong_content_type_pct: 0.0

  # Frequent bursts - the key stress factor
  burst:
    enabled: true
    interval_sec: 30
    duration_sec: 5
    rate_limit_pct: 80
    capacity_pct: 50
