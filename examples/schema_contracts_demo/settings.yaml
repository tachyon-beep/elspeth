source:
  plugin: csv
  on_success: source_out
  options:
    path: examples/schema_contracts_demo/input.csv
    schema:
      mode: flexible
      fields:
      - 'customer_id: str'
      - 'amount_usd: float'
      - 'transaction_date_time: str'
      - 'product_name: str'
      - 'status_active_inactive: str'
      - 'notes_comments: str'
    normalize_fields: true
    on_validation_failure: discard
transforms:
- name: passthrough_0
  plugin: passthrough
  input: source_out
  options:
    schema:
      mode: observed
sinks:
  output:
    plugin: csv
    options:
      path: examples/schema_contracts_demo/output/processed.csv
      schema:
        mode: fixed
        fields:
        - 'customer_id: str'
        - 'amount_usd: float'
        - 'transaction_date_time: str'
        - 'product_name: str'
        - 'status_active_inactive: str'
        - 'notes_comments: str'
  high_value:
    plugin: csv
    options:
      path: examples/schema_contracts_demo/output/high_value.csv
      schema:
        mode: fixed
        fields:
        - 'customer_id: str'
        - 'amount_usd: float'
        - 'transaction_date_time: str'
        - 'product_name: str'
        - 'status_active_inactive: str'
        - 'notes_comments: str'
gates:
- name: high_value_gate
  input: passthrough_0
  condition: row['amount_usd'] >= 500
  routes:
    'true': high_value
    'false': output
landscape:
  url: sqlite:///examples/schema_contracts_demo/runs/audit.db
