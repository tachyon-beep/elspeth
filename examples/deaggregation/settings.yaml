source:
  plugin: csv
  on_success: deagg_in
  options:
    path: examples/deaggregation/input.csv
    schema:
      mode: fixed
      fields:
      - 'id: int'
      - 'name: str'
      - 'copies: int'
      - 'category: str'
    on_validation_failure: discard
aggregations:
- name: replicate_batch
  plugin: batch_replicate
  input: deagg_in
  on_success: output
  trigger:
    count: 3
  output_mode: transform
  options:
    schema:
      mode: observed
    copies_field: copies
    default_copies: 1
    include_copy_index: true
sinks:
  output:
    plugin: csv
    options:
      path: examples/deaggregation/output/replicated.csv
      schema:
        mode: fixed
        fields:
        - 'id: int'
        - 'name: str'
        - 'copies: int'
        - 'category: str'
        - 'copy_index: int'
landscape:
  url: sqlite:///examples/deaggregation/runs/audit.db
