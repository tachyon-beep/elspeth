source:
  plugin: csv
  on_success: source_out
  options:
    path: examples/openrouter_sentiment/input.csv
    schema:
      mode: fixed
      fields:
      - 'id: int'
      - 'text: str'
    on_validation_failure: discard
transforms:
- name: openrouter_llm_0
  plugin: openrouter_llm
  input: source_out
  on_success: output
  on_error: quarantine
  options:
    api_key: ${OPENROUTER_API_KEY}
    model: openai/gpt-4o-mini
    template: 'Analyze the sentiment of the following text and respond with ONLY a JSON object.


      Text: {{ row.text }}


      Respond with exactly this format (no other text):

      {"sentiment": "positive" or "negative" or "neutral", "confidence": 0.0-1.0, "summary": "brief explanation"}

      '
    temperature: 0.0
    response_field: sentiment_analysis
    required_input_fields:
    - text
    schema:
      mode: observed
sinks:
  output:
    plugin: json
    options:
      path: examples/openrouter_sentiment/output/results.json
      schema:
        mode: observed
      format: jsonl
  quarantine:
    plugin: json
    options:
      path: examples/openrouter_sentiment/output/quarantine.json
      schema:
        mode: observed
landscape:
  url: sqlite:///examples/openrouter_sentiment/runs/audit.db
