source:
  plugin: csv
  on_success: source_out
  options:
    path: examples/openrouter_multi_query_assessment/input_overflow.csv
    schema:
      mode: flexible
      fields:
      - 'user_id: str'
      - 'cs1_word: str'
      - 'cs1_number: str'
      - 'cs1_color: str'
      - 'cs2_word: str'
      - 'cs2_number: str'
      - 'cs2_color: str'
    on_validation_failure: discard
transforms:
- plugin: openrouter_multi_query_llm
  name: assessment_multi_query
  input: source_out
  on_success: output
  options:
    model: anthropic/claude-3-5-sonnet
    api_key: ${OPENROUTER_API_KEY}
    system_prompt: "You are an echo bot. Your ONLY job is to echo back the exact values\nprovided in the query. Respond in\
      \ this EXACT JSON format:\n{\n  \"echo_row\": \"<the ROW value>\",\n  \"echo_case\": \"<the CASE value>\",\n  \"echo_criterion\"\
      : \"<the CRITERION value>\",\n  \"echo_word\": \"<the WORD value>\",\n  \"echo_number\": \"<the NUMBER value>\",\n \
      \ \"echo_color\": \"<the COLOR value>\"\n}\n\nCopy the values EXACTLY as provided. Do not add or change anything.\n"
    template: 'ECHO THESE VALUES EXACTLY:


      ROW={{ row.row.user_id }}

      CASE={{ row.case_study.name }}

      CRITERION={{ row.criterion.code }}

      WORD={{ row.input_1 }}

      NUMBER={{ row.input_2 }}

      COLOR={{ row.input_3 }}


      Respond with JSON containing these exact values.

      '
    required_input_fields: []
    case_studies:
    - name: cs1
      input_fields:
      - cs1_word
      - cs1_number
      - cs1_color
    - name: cs2
      input_fields:
      - cs2_word
      - cs2_number
      - cs2_color
    criteria:
    - name: criterion_a
      code: CRIT-A
      description: First criterion
    - name: criterion_b
      code: CRIT-B
      description: Second criterion
    - name: criterion_c
      code: CRIT-C
      description: Third criterion
    - name: criterion_d
      code: CRIT-D
      description: Fourth criterion
    - name: criterion_e
      code: CRIT-E
      description: Fifth criterion
    response_format: standard
    output_mapping:
      echo_row:
        suffix: echo_row
        type: string
      echo_case:
        suffix: echo_case
        type: string
      echo_criterion:
        suffix: echo_criterion
        type: string
      echo_word:
        suffix: echo_word
        type: string
      echo_number:
        suffix: echo_number
        type: string
      echo_color:
        suffix: echo_color
        type: string
    pool_size: 5
    temperature: 0.0
    max_tokens: 200
    schema:
      mode: observed
sinks:
  output:
    plugin: csv
    options:
      path: examples/openrouter_multi_query_assessment/output/overflow_results.csv
      schema:
        mode: observed
landscape:
  url: sqlite:///examples/openrouter_multi_query_assessment/runs/overflow_audit.db
