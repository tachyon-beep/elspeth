landscape:
  url: sqlite:///examples/template_lookups/runs/audit.db
source:
  plugin: csv
  on_success: source_out
  options:
    path: examples/template_lookups/input.csv
    on_validation_failure: discard
    schema:
      mode: fixed
      fields:
      - 'ticket_id: str'
      - 'category_id: str'
      - 'priority_id: str'
      - 'subject: str'
      - 'body: str'
sinks:
  output:
    plugin: json
    options:
      path: examples/template_lookups/output/results.json
      schema:
        mode: observed
      format: jsonl
  quarantine:
    plugin: json
    options:
      path: examples/template_lookups/output/quarantine.json
      schema:
        mode: observed
transforms:
- name: openrouter_llm_0
  plugin: openrouter_llm
  input: source_out
  on_success: output
  on_error: quarantine
  options:
    model: anthropic/claude-3-haiku
    api_key: ${OPENROUTER_API_KEY}
    template_file: prompts/classify.j2
    lookup_file: prompts/categories.yaml
    system_prompt: 'You are a precise customer support ticket classifier.

      Always respond with valid JSON matching the requested format.

      Be concise but accurate in your analysis.

      '
    temperature: 0.1
    max_tokens: 500
    response_field: classification
    required_input_fields:
    - ticket_id
    - category_id
    - priority_id
    - subject
    - body
    schema:
      mode: observed
