source:
  plugin: csv
  options:
    path: examples/audit_export/input.csv
    schema:
      mode: fixed
      fields:
      - 'id: int'
      - 'name: str'
      - 'amount: int'
      - 'category: str'
    on_validation_failure: discard
    on_success: non_corporate
gates:
- name: category_router
  condition: row['category'] == 'corporate'
  routes:
    'true': corporate
    'false': non_corporate
sinks:
  non_corporate:
    plugin: csv
    options:
      path: examples/audit_export/output/non_corporate.csv
      schema:
        mode: fixed
        fields:
        - 'id: int'
        - 'name: str'
        - 'amount: int'
        - 'category: str'
  corporate:
    plugin: csv
    options:
      path: examples/audit_export/output/corporate.csv
      schema:
        mode: fixed
        fields:
        - 'id: int'
        - 'name: str'
        - 'amount: int'
        - 'category: str'
  audit_export:
    plugin: json
    options:
      path: examples/audit_export/output/audit_trail.json
      schema:
        mode: observed
landscape:
  url: sqlite:///examples/audit_export/runs/audit.db
  export:
    enabled: true
    sink: audit_export
    format: json
    sign: false
