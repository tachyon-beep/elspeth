source:
  plugin: csv
  on_success: batch_in
  options:
    path: examples/batch_aggregation/input.csv
    schema:
      mode: fixed
      fields:
      - 'id: int'
      - 'date: str'
      - 'category: str'
      - 'amount: int'
      - 'region: str'
    on_validation_failure: discard
aggregations:
- name: batch_totals
  plugin: batch_stats
  input: batch_in
  on_success: output
  trigger:
    count: 5
  output_mode: transform
  options:
    schema:
      mode: observed
    value_field: amount
    group_by: category
    compute_mean: true
sinks:
  output:
    plugin: csv
    options:
      path: examples/batch_aggregation/output/batch_summaries.csv
      schema:
        mode: fixed
        fields:
        - 'count: int'
        - 'sum: float'
        - 'batch_size: int'
        - 'mean: float'
        - 'category: str'
landscape:
  url: sqlite:///examples/batch_aggregation/runs/audit.db
