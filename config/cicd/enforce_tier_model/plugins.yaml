per_file_rules:
- pattern: plugins/sources/*
  rules:
  - R1
  - R2
  - R3
  - R4
  - R5
  - R6
  - R9
  reason: Source plugins ingest external data (Tier 3) - all defensive patterns legitimate
  expires: null
- pattern: plugins/config_base.py
  rules:
  - R1
  - R5
  reason: Plugin config parsing handles user YAML config (Tier 3) - defensive access for optional fields
  expires: null
- pattern: plugins/llm/*
  rules:
  - R1
  - R2
  - R3
  - R4
  - R5
  - R6
  - R9
  reason: LLM API responses are external data (Tier 3) - all defensive patterns legitimate
  expires: null
- pattern: plugins/azure/*
  rules:
  - R1
  - R2
  - R3
  - R4
  - R5
  - R6
  - R9
  reason: Azure API responses are external data (Tier 3) - all defensive patterns legitimate
  expires: null
allow_hits:
- key: plugins/batching/mixin.py:R6:BatchTransformMixin:_release_loop:fp=efe10b71fb5afade
  owner: architecture
  reason: Silent recovery with explicit error handling path
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R6:BatchTransformMixin:_release_loop:fp=4217324caed47be5
  owner: architecture
  reason: Silent recovery with explicit error handling path
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/clients/http.py:R6:AuditedHTTPClient:_filter_request_headers:fp=fa8d66197cd636d9
  owner: architecture
  reason: Silent recovery with explicit error handling path
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/discovery.py:R9:_discover_in_file:fp=77f2deccecaa5aea
  owner: architecture
  reason: Cleanup/pop with default - key may not exist in race or optional scenarios
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/discovery.py:R2:get_plugin_description:fp=0806b3aad609f380
  owner: architecture
  reason: getattr for optional attribute access
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/utils.py:R5:get_nested_field:fp=b9f0121cf1ecd05f
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/sinks/database_sink.py:R1:DatabaseSink:__init__:fp=2313ec3565068c68
  owner: architecture
  reason: Optional field access at trust boundary
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/sinks/json_sink.py:R5:JSONSink:validate_output_target:fp=78857e43dc69519e
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/batch_replicate.py:R5:BatchReplicate:process:fp=7d0ded8e77f9f3ac
  owner: architecture
  reason: Tier 2 contract enforcement - isinstance validates copies_field type before arithmetic
  safety: Wrong types crash (upstream bug); wrong values quarantined via error result
  expires: '2026-05-02'
- key: plugins/transforms/keyword_filter.py:R5:KeywordFilter:process:fp=215bae67b700c3fd
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/keyword_filter.py:R5:KeywordFilter:_get_fields_to_scan:fp=f93822a8a17d752b
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/keyword_filter.py:R5:KeywordFilter:_get_fields_to_scan:fp=840bd57450114a00
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/json_explode.py:R5:JSONExplode:process:fp=0bd8dc8dca329b8b
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/sources/field_normalization.py:R8:check_normalization_collisions:fp=5d89837a5521627f
  owner: architecture
  reason: setdefault for lazy initialization
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/sources/field_normalization.py:R8:check_mapping_collisions:fp=a1371511b3dee8c6
  owner: architecture
  reason: setdefault for lazy initialization
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/pooling/executor.py:R5:PooledExecutor:_execute_single:fp=923431e7c7c800eb
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/pooling/executor.py:R5:PooledExecutor:_execute_single:fp=bbe24a28f3c7d484
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R4:BatchTransformMixin:_process_and_complete:fp=d4e6055c5d8f51b2
  owner: architecture
  reason: Broad exception handling at external boundary with logging
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R7:BatchTransformMixin:_process_and_complete:fp=c6fcb5c8ffb813fa
  owner: architecture
  reason: contextlib.suppress for expected exceptions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R7:BatchTransformMixin:_process_and_complete:fp=03c17e4a2a2b4f61
  owner: architecture
  reason: contextlib.suppress for expected exceptions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R9:BatchTransformMixin:_release_loop:fp=1eb8d42fd33ba478
  owner: architecture
  reason: Cleanup/pop with default - key may not exist in race or optional scenarios
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R4:BatchTransformMixin:_release_loop:fp=a710984dc1fb9979
  owner: architecture
  reason: Broad exception handling at external boundary with logging
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R4:BatchTransformMixin:_release_loop:fp=9230e59132d3de9f
  owner: architecture
  reason: Broad exception handling at external boundary with logging
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R9:BatchTransformMixin:evict_submission:fp=d64346e2eacd33f3
  owner: architecture
  reason: Cleanup/pop with default - key may not exist in race or optional scenarios
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/clients/http.py:R1:AuditedHTTPClient:_filter_request_headers:fp=67d8cd6ce6ab133f
  owner: architecture
  reason: Optional field access at trust boundary
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/clients/llm.py:R1:LLMResponse:total_tokens:fp=f97a4254a3ac6975
  owner: architecture
  reason: Optional field access at trust boundary
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/clients/llm.py:R1:LLMResponse:total_tokens:fp=66b4ed77a37877c1
  owner: architecture
  reason: Optional field access at trust boundary
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/content_safety.py:R5:AzureContentSafety:_process_single_with_state:fp=8404ee8567c3b226
  owner: architecture
  reason: Tier 3 boundary — validates row field is str before sending to Azure API
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/content_safety.py:R5:AzureContentSafety:_get_fields_to_scan:fp=4bc821183ed1cfbd
  owner: architecture
  reason: Tier 2 row filtering — isinstance selects str fields for content scanning
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/content_safety.py:R5:AzureContentSafety:_get_fields_to_scan:fp=1617ec4ae04857b6
  owner: architecture
  reason: Tier 2 row filtering — isinstance selects str fields for content scanning
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/content_safety.py:R1:AzureContentSafety:_analyze_content:fp=9cbec0737e033ad0
  owner: architecture
  reason: Tier 3 boundary — .get() on Azure API response to check unknown categories
  safety: Unknown categories logged, only mapped categories used. MalformedResponseError raised if expected categories missing.
  expires: '2026-05-02'
- key: plugins/transforms/azure/content_safety.py:R5:AzureContentSafety:_analyze_content:fp=132e9c8653a9a14b
  owner: architecture
  reason: Tier 3 boundary — validates severity type from Azure API response is int
  safety: MalformedResponseError raised if type wrong, caught as non-retryable error
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_process_single_with_state:fp=69fe83d9ba6aa6e9
  owner: architecture
  reason: Tier 3 boundary — validates row field is str before sending to Azure API
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_get_fields_to_scan:fp=26f6b1fa2d11c919
  owner: architecture
  reason: Tier 2 row filtering — isinstance selects str fields for scanning
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_get_fields_to_scan:fp=71955a9599f4811d
  owner: architecture
  reason: Tier 2 row filtering — isinstance selects str fields for scanning
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
# _analyze_prompt: Tier 3 boundary — Azure Prompt Shield API response validation
# Refactored to support analysis_type config (user_prompt/document/both)
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_analyze_prompt:fp=f36e9ff80839e633
  owner: architecture
  reason: Tier 3 boundary — isinstance check on data before .get() (Azure API response)
  safety: MalformedResponseError raised on wrong type
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R1:AzurePromptShield:_analyze_prompt:fp=6a16137fe3456586
  owner: architecture
  reason: Tier 3 boundary — .get() on Azure API response to extract userPromptAnalysis
  safety: MalformedResponseError raised if field missing or wrong type
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_analyze_prompt:fp=fc77bfc1466ceb02
  owner: architecture
  reason: Tier 3 boundary — validates userPromptAnalysis is dict from Azure response
  safety: MalformedResponseError raised on wrong type
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R1:AzurePromptShield:_analyze_prompt:fp=8dced5da65bac939
  owner: architecture
  reason: Tier 3 boundary — .get() on Azure response to extract attackDetected field
  safety: MalformedResponseError raised if field missing or wrong type
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_analyze_prompt:fp=26563e04e526eb0c
  owner: architecture
  reason: Tier 3 boundary — validates attackDetected is bool from Azure response
  safety: MalformedResponseError raised on wrong type
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_analyze_prompt:fp=d6e521cc7434465a
  owner: architecture
  reason: Tier 3 boundary — isinstance check on data before .get() for documentsAnalysis
  safety: MalformedResponseError raised on wrong type
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R1:AzurePromptShield:_analyze_prompt:fp=79ca99232d475d15
  owner: architecture
  reason: Tier 3 boundary — .get() on Azure response to extract documentsAnalysis
  safety: MalformedResponseError raised if field missing or wrong type
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_analyze_prompt:fp=f0d2d26e6db3b0f0
  owner: architecture
  reason: Tier 3 boundary — validates documentsAnalysis is list from Azure response
  safety: MalformedResponseError raised on wrong type
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_analyze_prompt:fp=86268888f61bf825
  owner: architecture
  reason: Tier 3 boundary — validates each document entry is dict from Azure response
  safety: MalformedResponseError raised on wrong type
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R1:AzurePromptShield:_analyze_prompt:fp=8a246f87b27c5cb7
  owner: architecture
  reason: Tier 3 boundary — .get() on document dict to extract attackDetected
  safety: MalformedResponseError raised if field missing or wrong type
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_analyze_prompt:fp=4ab43fcbe8760d53
  owner: architecture
  reason: Tier 3 boundary — validates document attackDetected is bool from Azure response
  safety: MalformedResponseError raised on wrong type
  expires: '2026-05-02'
- key: plugins/clients/llm.py:R4:AuditedLLMClient:chat_completion:fp=bf79975bdf2ede4c
  owner: architecture
  reason: Telemetry emission failure - must not crash main LLM call flow
  safety: Logged and continues - telemetry is non-critical to LLM processing
  expires: '2026-05-02'
- key: plugins/clients/llm.py:R4:AuditedLLMClient:chat_completion:fp=3979cd7bedc550ef
  owner: architecture
  reason: Telemetry emission failure - must not crash main LLM call flow
  safety: Logged and continues - telemetry is non-critical to LLM processing
  expires: '2026-05-02'
- key: plugins/sinks/csv_sink.py:R1:CSVSink:_open_file:fp=5513c655d6bb1799
  owner: feature
  reason: Intentional fallback - reverse mapping may not contain all fields (transform-added)
  safety: Falls back to original field name - correct behavior for fields not in source
  expires: null
- key: plugins/sinks/csv_sink.py:R1:CSVSink:_get_field_names_and_display:fp=4b1188b665744b55
  owner: feature
  reason: Intentional fallback - display mapping may not contain all fields (transform-added)
  safety: Falls back to normalized field name - correct behavior for fields not in source
  expires: null
- key: plugins/sinks/csv_sink.py:R1:CSVSink:validate_output_target:fp=4f8918e243e34a1a
  owner: feature
  reason: Display header mapping - fields not in map keep original name (transform-added fields)
  safety: Intentional fallback to original field name, not bug hiding
  expires: null
- key: plugins/sinks/json_sink.py:R1:JSONSink:validate_output_target:fp=6734d84d40b2178e
  owner: feature
  reason: Display header mapping - fields not in map keep original name (transform-added fields)
  safety: Intentional fallback to original field name, not bug hiding
  expires: null
- key: plugins/sinks/json_sink.py:R1:JSONSink:_apply_display_headers:fp=e4e90c2776c1a966
  owner: feature
  reason: Display header mapping - fields not in map keep original name (transform-added fields)
  safety: Intentional fallback to original field name, not bug hiding
  expires: null
- key: plugins/transforms/batch_stats.py:R5:BatchStats:process:fp=f54b9087450d567e
  owner: P1-2026-02-05-typecheck
  reason: Internal boundary - PipelineRow vs dict discrimination after mypy typecheck fixes
  safety: isinstance() check required to handle union type from batch processing
  expires: null
- key: plugins/transforms/batch_stats.py:R5:BatchStats:process:fp=2ab97d065af608ef
  owner: architecture
  reason: Tier 2 row value type discrimination — float vs int for NaN/Infinity check (ints always finite)
  safety: Preserves int precision for values > 2^53; only floats need isfinite() guard
  expires: null
- key: plugins/transforms/batch_stats.py:R5:BatchStats:process:fp=fb6ac6c75fbf49f7
  owner: architecture
  reason: Tier 2 overflow guard — only float sums can overflow to Infinity (int sums use arbitrary precision)
  safety: Returns TransformResult.error() on overflow; int path cannot trigger this
  expires: null
- key: plugins/clients/http.py:R5:_contains_non_finite:fp=d5037eea8e8b02f2
  owner: architecture
  reason: isinstance() on float to detect NaN/Infinity in JSON - type discrimination for serialization
  safety: Rejects non-finite values that would break RFC 8785 canonicalization
  expires: '2026-05-02'
- key: plugins/clients/http.py:R5:_contains_non_finite:fp=7d273e64067f45ff
  owner: architecture
  reason: isinstance() on dict for recursive NaN/Infinity scan - type discrimination for serialization
  safety: Traverses JSON structure to find non-finite floats before audit recording
  expires: '2026-05-02'
- key: plugins/clients/http.py:R5:_contains_non_finite:fp=3c42440cd2aaf7fc
  owner: architecture
  reason: isinstance() on list for recursive NaN/Infinity scan - type discrimination for serialization
  safety: Traverses JSON structure to find non-finite floats before audit recording
  expires: '2026-05-02'
- key: plugins/transforms/web_scrape.py:R4:WebScrapeTransform:process:fp=ba13e0d9177595d6
  owner: architecture
  reason: Tier 3 boundary - response.text is external data, extract_content() can fail unpredictably
  safety: Returns TransformResult.error() for quarantine with reason, error_type, and URL
  expires: '2026-05-02'
# Refactored: post()/get() shared logic now in _execute_request/_parse_response_body/_record_and_emit
- key: plugins/clients/http.py:R1:AuditedHTTPClient:_parse_response_body:fp=1b8441ef483bc723
  owner: architecture
  reason: HTTP response content-type header - external system boundary, header may be missing
  safety: Falls back to binary encoding if content-type absent
  expires: '2026-05-02'
- key: plugins/clients/http.py:R4:AuditedHTTPClient:_record_and_emit:fp=e6561b1525ab61cf
  owner: architecture
  reason: Telemetry emission failure - must not crash main request flow
  safety: Logged and continues - telemetry is non-critical to HTTP processing
  expires: '2026-05-02'
- key: plugins/clients/http.py:R1:AuditedHTTPClient:_execute_request:fp=c9e764febf819aac
  owner: architecture
  reason: httpx Client.get() method call - dispatched based on HTTP method
  safety: This is the actual external HTTP call, not a defensive dict access
  expires: '2026-05-02'
- key: plugins/clients/http.py:R1:AuditedHTTPClient:get_ssrf_safe:fp=f87a3780dd590ab9
  owner: architecture
  reason: httpx Client.get() method call - ephemeral client for TLS/SNI isolation
  safety: This is the actual external HTTP call with IP pinning
  expires: '2026-05-02'
- key: plugins/clients/http.py:R1:AuditedHTTPClient:get_ssrf_safe:fp=072c0cda3555a6a7
  owner: architecture
  reason: HTTP response content-type header - external system boundary, header may be missing
  safety: Falls back to binary encoding if content-type absent
  expires: '2026-05-02'
- key: plugins/clients/http.py:R4:AuditedHTTPClient:get_ssrf_safe:fp=d6d5b5ea39fda352
  owner: architecture
  reason: Telemetry emission failure - must not crash main request flow
  safety: Logged and continues - telemetry is non-critical to HTTP processing
  expires: '2026-05-02'
- key: plugins/clients/http.py:R4:AuditedHTTPClient:get_ssrf_safe:fp=9f6d869cb3f27e15
  owner: architecture
  reason: Telemetry emission failure - must not crash main request flow
  safety: Logged and continues - telemetry is non-critical to HTTP processing
  expires: '2026-05-02'
- key: plugins/clients/http.py:R1:AuditedHTTPClient:_follow_redirects_safe:fp=617c44193bd67379
  owner: architecture
  reason: HTTP redirect Location header - external system boundary, header may be absent
  safety: Missing Location header breaks redirect loop naturally (no redirect target)
  expires: '2026-05-02'
- key: plugins/clients/http.py:R1:AuditedHTTPClient:_follow_redirects_safe:fp=567e1ce1b3e22c2c
  owner: architecture
  reason: httpx Client.get() method call - ephemeral client per redirect hop for TLS isolation
  safety: This is the actual external HTTP call, not a defensive dict access
  expires: '2026-05-02'
- key: plugins/sources/csv_source.py:R7:CSVSource:load:fp=f69de22403a3594b
  owner: architecture
  reason: Tier 3 boundary — skip_rows targets non-CSV metadata preamble that may violate RFC 4180
  safety: User explicitly configured these rows to be discarded; csv.Error during skip is irrelevant
  expires: null
