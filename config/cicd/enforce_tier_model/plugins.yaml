per_file_rules:
- pattern: plugins/sources/*
  rules:
  - R1
  - R2
  - R3
  - R4
  - R5
  - R6
  - R9
  reason: Source plugins ingest external data (Tier 3) - all defensive patterns legitimate
  expires: null
- pattern: plugins/config_base.py
  rules:
  - R1
  - R5
  reason: Plugin config parsing handles user YAML config (Tier 3) - defensive access for optional fields
  expires: null
- pattern: plugins/llm/*
  rules:
  - R1
  - R2
  - R3
  - R4
  - R5
  - R6
  - R9
  reason: LLM API responses are external data (Tier 3) - all defensive patterns legitimate
  expires: null
- pattern: plugins/azure/*
  rules:
  - R1
  - R2
  - R3
  - R4
  - R5
  - R6
  - R9
  reason: Azure API responses are external data (Tier 3) - all defensive patterns legitimate
  expires: null
allow_hits:
- key: plugins/batching/mixin.py:R6:BatchTransformMixin:_release_loop:fp=efe10b71fb5afade
  owner: architecture
  reason: Silent recovery with explicit error handling path
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R6:BatchTransformMixin:_release_loop:fp=4217324caed47be5
  owner: architecture
  reason: Silent recovery with explicit error handling path
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/clients/http.py:R6:AuditedHTTPClient:_filter_request_headers:fp=c5c171afc5be7b56
  owner: architecture
  reason: Silent recovery with explicit error handling path
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/discovery.py:R9:_discover_in_file:fp=77f2deccecaa5aea
  owner: architecture
  reason: Cleanup/pop with default - key may not exist in race or optional scenarios
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/discovery.py:R2:_discover_in_file:fp=f42969a5d77096b3
  owner: architecture
  reason: getattr for optional attribute access
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/discovery.py:R2:get_plugin_description:fp=0806b3aad609f380
  owner: architecture
  reason: getattr for optional attribute access
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/utils.py:R5:get_nested_field:fp=65234e1b71a7a0fc
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/validation.py:R5:PluginConfigValidator:validate_source_config:fp=3bd8f6558f2b54b2
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/validation.py:R5:PluginConfigValidator:validate_transform_config:fp=b60f09b21ed871b6
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/sinks/database_sink.py:R1:DatabaseSink:__init__:fp=2313ec3565068c68
  owner: architecture
  reason: Optional field access at trust boundary
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/sinks/json_sink.py:R5:JSONSink:validate_output_target:fp=8dc25260f8a13296
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/batch_replicate.py:R5:BatchReplicate:process:fp=7d0ded8e77f9f3ac
  owner: architecture
  reason: Tier 2 contract enforcement - isinstance validates copies_field type before arithmetic
  safety: Wrong types crash (upstream bug); wrong values quarantined via error result
  expires: '2026-05-02'
- key: plugins/transforms/keyword_filter.py:R5:KeywordFilter:process:fp=9160e4e0b95ed5e8
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/keyword_filter.py:R5:KeywordFilter:_get_fields_to_scan:fp=af2344f0f0f5938f
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/keyword_filter.py:R5:KeywordFilter:_get_fields_to_scan:fp=840bd57450114a00
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/truncate.py:R5:Truncate:process:fp=bc395c6a768847b9
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/truncate.py:R5:Truncate:process:fp=ae444b17b823e17a
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/json_explode.py:R5:JSONExplode:process:fp=0bd8dc8dca329b8b
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/sources/field_normalization.py:R8:check_normalization_collisions:fp=5d89837a5521627f
  owner: architecture
  reason: setdefault for lazy initialization
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/sources/field_normalization.py:R8:check_mapping_collisions:fp=a1371511b3dee8c6
  owner: architecture
  reason: setdefault for lazy initialization
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/pooling/executor.py:R5:PooledExecutor:_execute_single:fp=923431e7c7c800eb
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/pooling/executor.py:R5:PooledExecutor:_execute_single:fp=bbe24a28f3c7d484
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R4:BatchTransformMixin:_process_and_complete:fp=d4e6055c5d8f51b2
  owner: architecture
  reason: Broad exception handling at external boundary with logging
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R7:BatchTransformMixin:_process_and_complete:fp=c6fcb5c8ffb813fa
  owner: architecture
  reason: contextlib.suppress for expected exceptions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R7:BatchTransformMixin:_process_and_complete:fp=03c17e4a2a2b4f61
  owner: architecture
  reason: contextlib.suppress for expected exceptions
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R9:BatchTransformMixin:_release_loop:fp=1eb8d42fd33ba478
  owner: architecture
  reason: Cleanup/pop with default - key may not exist in race or optional scenarios
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R4:BatchTransformMixin:_release_loop:fp=a710984dc1fb9979
  owner: architecture
  reason: Broad exception handling at external boundary with logging
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R4:BatchTransformMixin:_release_loop:fp=9230e59132d3de9f
  owner: architecture
  reason: Broad exception handling at external boundary with logging
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/batching/mixin.py:R9:BatchTransformMixin:evict_submission:fp=d64346e2eacd33f3
  owner: architecture
  reason: Cleanup/pop with default - key may not exist in race or optional scenarios
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/clients/http.py:R1:AuditedHTTPClient:_filter_request_headers:fp=8c35c9e302cece59
  owner: architecture
  reason: Optional field access at trust boundary
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/clients/llm.py:R1:LLMResponse:total_tokens:fp=5bdbfe7db9e32163
  owner: architecture
  reason: Optional field access at trust boundary
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/clients/llm.py:R1:LLMResponse:total_tokens:fp=695415b2ec4d8fee
  owner: architecture
  reason: Optional field access at trust boundary
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/content_safety.py:R9:AzureContentSafety:_process_row:fp=b18b4272385d82ff
  owner: architecture
  reason: Cleanup/pop with default — HTTP client cleanup may race with error paths
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/content_safety.py:R5:AzureContentSafety:_process_single_with_state:fp=8404ee8567c3b226
  owner: architecture
  reason: Tier 3 boundary — validates row field is str before sending to Azure API
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/content_safety.py:R5:AzureContentSafety:_get_fields_to_scan:fp=9bb006a32eb07a28
  owner: architecture
  reason: Tier 2 row filtering — isinstance selects str fields for content scanning
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/content_safety.py:R5:AzureContentSafety:_get_fields_to_scan:fp=1617ec4ae04857b6
  owner: architecture
  reason: Tier 2 row filtering — isinstance selects str fields for content scanning
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/content_safety.py:R1:AzureContentSafety:_analyze_content:fp=9cbec0737e033ad0
  owner: architecture
  reason: Tier 3 boundary — .get() on Azure API response to check unknown categories
  safety: Unknown categories logged, only mapped categories used. MalformedResponseError raised if expected categories missing.
  expires: '2026-05-02'
- key: plugins/transforms/azure/content_safety.py:R5:AzureContentSafety:_analyze_content:fp=132e9c8653a9a14b
  owner: architecture
  reason: Tier 3 boundary — validates severity type from Azure API response is int
  safety: MalformedResponseError raised if type wrong, caught as non-retryable error
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R9:AzurePromptShield:_process_row:fp=5555041200ea3e5a
  owner: architecture
  reason: Cleanup/pop with default — HTTP client cleanup may race with error paths
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_process_single_with_state:fp=69fe83d9ba6aa6e9
  owner: architecture
  reason: Tier 3 boundary — validates row field is str before sending to Azure API
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_get_fields_to_scan:fp=6756f72f855a6bcf
  owner: architecture
  reason: Tier 2 row filtering — isinstance selects str fields for scanning
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_get_fields_to_scan:fp=71955a9599f4811d
  owner: architecture
  reason: Tier 2 row filtering — isinstance selects str fields for scanning
  safety: Code reviewed - legitimate pattern
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_analyze_prompt:fp=5ebfe1bb3a77f354
  owner: architecture
  reason: Tier 3 boundary — validates Azure response structure before parsing
  safety: MalformedResponseError raised on wrong type, caught as non-retryable error
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R1:AzurePromptShield:_analyze_prompt:fp=ec7bffed1b84a52f
  owner: architecture
  reason: Tier 3 boundary — .get() on Azure API response to extract userPromptAnalysis
  safety: MalformedResponseError raised if field missing or wrong type
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_analyze_prompt:fp=9e2efc70e9c2a9dc
  owner: architecture
  reason: Tier 3 boundary — validates userPromptAnalysis is dict from Azure response
  safety: MalformedResponseError raised on wrong type, caught as non-retryable error
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R1:AzurePromptShield:_analyze_prompt:fp=3b3f342da93a70a8
  owner: architecture
  reason: Tier 3 boundary — .get() on Azure response to extract attackDetected field
  safety: MalformedResponseError raised if field missing or wrong type
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_analyze_prompt:fp=c841d2c305e52b38
  owner: architecture
  reason: Tier 3 boundary — validates attackDetected is bool from Azure response
  safety: MalformedResponseError raised on wrong type, caught as non-retryable error
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R1:AzurePromptShield:_analyze_prompt:fp=40253c1ac93c9dee
  owner: architecture
  reason: Tier 3 boundary — .get() on Azure response to extract documentsAnalysis
  safety: MalformedResponseError raised if field missing or wrong type
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_analyze_prompt:fp=f580cd433ba3ceaa
  owner: architecture
  reason: Tier 3 boundary — validates documentsAnalysis is list from Azure response
  safety: MalformedResponseError raised on wrong type, caught as non-retryable error
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_analyze_prompt:fp=7253081edf54b8ad
  owner: architecture
  reason: Tier 3 boundary — validates each document entry is dict from Azure response
  safety: MalformedResponseError raised on wrong type, caught as non-retryable error
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R1:AzurePromptShield:_analyze_prompt:fp=6fc4cb2a3c9fe209
  owner: architecture
  reason: Tier 3 boundary — .get() on document dict to extract attackDetected
  safety: MalformedResponseError raised if field missing or wrong type
  expires: '2026-05-02'
- key: plugins/transforms/azure/prompt_shield.py:R5:AzurePromptShield:_analyze_prompt:fp=decde02c66d672a3
  owner: architecture
  reason: Tier 3 boundary — validates document attackDetected is bool from Azure response
  safety: MalformedResponseError raised on wrong type, caught as non-retryable error
  expires: '2026-05-02'
- key: plugins/clients/llm.py:R4:AuditedLLMClient:chat_completion:fp=cb8f391ad82b21df
  owner: architecture
  reason: Telemetry emission failure - must not crash main LLM call flow
  safety: Logged and continues - telemetry is non-critical to LLM processing
  expires: '2026-05-02'
- key: plugins/clients/llm.py:R4:AuditedLLMClient:chat_completion:fp=6b5b01f9759184f2
  owner: architecture
  reason: Telemetry emission failure - must not crash main LLM call flow
  safety: Logged and continues - telemetry is non-critical to LLM processing
  expires: '2026-05-02'
- key: plugins/sinks/csv_sink.py:R1:CSVSink:_open_file:fp=529df26a8624a42d
  owner: feature
  reason: Intentional fallback - reverse mapping may not contain all fields (transform-added)
  safety: Falls back to original field name - correct behavior for fields not in source
  expires: null
- key: plugins/sinks/csv_sink.py:R1:CSVSink:_get_field_names_and_display:fp=688e26cbcb3aa309
  owner: feature
  reason: Intentional fallback - display mapping may not contain all fields (transform-added)
  safety: Falls back to normalized field name - correct behavior for fields not in source
  expires: null
- key: plugins/sinks/csv_sink.py:R1:CSVSink:validate_output_target:fp=4f8918e243e34a1a
  owner: feature
  reason: Display header mapping - fields not in map keep original name (transform-added fields)
  safety: Intentional fallback to original field name, not bug hiding
  expires: null
- key: plugins/sinks/json_sink.py:R1:JSONSink:validate_output_target:fp=11a12d24c049f460
  owner: feature
  reason: Display header mapping - fields not in map keep original name (transform-added fields)
  safety: Intentional fallback to original field name, not bug hiding
  expires: null
- key: plugins/sinks/json_sink.py:R1:JSONSink:_apply_display_headers:fp=c5e1158dff11755a
  owner: feature
  reason: Display header mapping - fields not in map keep original name (transform-added fields)
  safety: Intentional fallback to original field name, not bug hiding
  expires: null
- key: plugins/transforms/batch_stats.py:R5:BatchStats:process:fp=f54b9087450d567e
  owner: P1-2026-02-05-typecheck
  reason: Internal boundary - PipelineRow vs dict discrimination after mypy typecheck fixes
  safety: isinstance() check required to handle union type from batch processing
  expires: null
- key: plugins/clients/http.py:R5:_contains_non_finite:fp=9370a8f4d789c2c1
  owner: architecture
  reason: isinstance() on float to detect NaN/Infinity in JSON - type discrimination for serialization
  safety: Rejects non-finite values that would break RFC 8785 canonicalization
  expires: '2026-05-02'
- key: plugins/clients/http.py:R5:_contains_non_finite:fp=cbbbfa89308db09a
  owner: architecture
  reason: isinstance() on dict for recursive NaN/Infinity scan - type discrimination for serialization
  safety: Traverses JSON structure to find non-finite floats before audit recording
  expires: '2026-05-02'
- key: plugins/clients/http.py:R5:_contains_non_finite:fp=4a5b03bd164d53bf
  owner: architecture
  reason: isinstance() on list for recursive NaN/Infinity scan - type discrimination for serialization
  safety: Traverses JSON structure to find non-finite floats before audit recording
  expires: '2026-05-02'
- key: plugins/transforms/web_scrape.py:R4:WebScrapeTransform:process:fp=ba13e0d9177595d6
  owner: architecture
  reason: Tier 3 boundary - response.text is external data, extract_content() can fail unpredictably
  safety: Returns TransformResult.error() for quarantine with reason, error_type, and URL
  expires: '2026-05-02'
- key: plugins/validation.py:R5:PluginConfigValidator:validate_sink_config:fp=39024a41cd690457
  owner: architecture
  reason: AST/type checking - required for safe parsing or discriminated unions
- key: plugins/validation.py:R1:PluginConfigValidator:_extract_errors:fp=76f7694624d8cfcc
  owner: architecture
  reason: Optional field access at trust boundary
- key: plugins/clients/http.py:R1:AuditedHTTPClient:post:fp=3c0be6939b9ad68c
  owner: architecture
  reason: HTTP response headers - external system boundary, content-type may be missing
- key: plugins/clients/http.py:R4:AuditedHTTPClient:post:fp=57f98d9a680c4fe0
  owner: architecture
  reason: Telemetry emission failure - must not crash main request flow
- key: plugins/clients/http.py:R4:AuditedHTTPClient:post:fp=8d0a8a1eebc183ff
  owner: architecture
  reason: Telemetry emission failure - must not crash main request flow
- key: plugins/clients/http.py:R1:AuditedHTTPClient:get:fp=de1053d26df88b2e
  owner: architecture
  reason: HTTP response headers - external system boundary, content-type may be missing
- key: plugins/clients/http.py:R1:AuditedHTTPClient:get:fp=8e3c6282a014e674
  owner: architecture
  reason: HTTP response headers - external system boundary, content-type may be missing
- key: plugins/clients/http.py:R4:AuditedHTTPClient:get:fp=828d933917d5becb
  owner: architecture
  reason: Telemetry emission failure - must not crash main request flow
- key: plugins/clients/http.py:R4:AuditedHTTPClient:get:fp=fd83274374bde4f7
  owner: architecture
  reason: Telemetry emission failure - must not crash main request flow
- key: plugins/clients/http.py:R1:AuditedHTTPClient:get_ssrf_safe:fp=4ca4e2477ece4e30
  owner: architecture
  reason: httpx Client.get() method call - ephemeral client for TLS/SNI isolation
- key: plugins/clients/http.py:R1:AuditedHTTPClient:get_ssrf_safe:fp=218c21461d517b71
  owner: architecture
  reason: httpx Client.get() method call - this is the external HTTP call with IP pinning
- key: plugins/clients/http.py:R4:AuditedHTTPClient:get_ssrf_safe:fp=51570a45a72c0c87
  owner: architecture
  reason: Telemetry emission failure - must not crash main request flow
- key: plugins/clients/http.py:R4:AuditedHTTPClient:get_ssrf_safe:fp=5592b5008ca0c900
  owner: architecture
  reason: Telemetry emission failure - must not crash main request flow
- key: plugins/clients/http.py:R1:AuditedHTTPClient:_follow_redirects_safe:fp=23c341af1cdd3b1e
  owner: architecture
  reason: HTTP redirect Location header - external system boundary, header may be absent
- key: plugins/clients/http.py:R1:AuditedHTTPClient:_follow_redirects_safe:fp=48a4d8f531e7c27d
  owner: architecture
  reason: HTTP redirect Location header - external system boundary, header may be absent
