# Types intentionally defined outside contracts/
# These are internal to their module and not used across boundaries
allowed_external_types:
  # TUI display types - presentation-specific, not cross-boundary contracts
  - "tui/types:TokenDisplayInfo"
  # DAG wiring helper type shared between CLI instantiation and graph construction
  - "core/dag/models:WiredTransform"
  # SSRF safety type - security infrastructure, tightly coupled to validation logic
  - "core/security/web:SSRFSafeRequest"
  # Engine types used in testing factories - test infrastructure wraps these for convenience
  - "engine/orchestrator/types:PipelineConfig"
  - "engine/orchestrator/types:RunResult"
  - "engine/orchestrator/types:AggregationFlushResult"
  - "engine/orchestrator/types:ExecutionCounters"

# dict[str, Any] patterns that are intentional
# Format: "file_path:context:param_name"
allowed_dict_patterns:
  # ═══════════════════════════════════════════════════════════════════════════
  # ROW DATA (THEIR DATA)
  # User pipeline data is inherently dynamic - we cannot know the schema.
  # These are wrapped in typed containers (TokenInfo) but the row content itself
  # can be anything the user's pipeline produces.
  # ═══════════════════════════════════════════════════════════════════════════

  # Engine - row data handling
  - "src/elspeth/engine/tokens.py:TokenManager.expand_token:expanded_rows (list)"
  - "src/elspeth/engine/processor.py:RowProcessor.get_aggregation_checkpoint_state:return"
  - "src/elspeth/engine/expression_parser.py:_ExpressionEvaluator.__init__:row"
  - "src/elspeth/engine/expression_parser.py:ExpressionParser.evaluate:row"
  - "src/elspeth/engine/coalesce_executor.py:CoalesceExecutor._merge_data:return"

  # Aggregation executor - checkpoint and state methods
  - "src/elspeth/engine/executors/aggregation.py:AggregationExecutor.get_buffered_rows:return (list)"
  - "src/elspeth/engine/executors/aggregation.py:AggregationExecutor.get_checkpoint_state:return"
  - "src/elspeth/engine/executors/aggregation.py:AggregationExecutor.restore_from_checkpoint:state"
  - "src/elspeth/engine/executors/aggregation.py:AggregationExecutor.restore_state:state"
  - "src/elspeth/engine/executors/aggregation.py:AggregationExecutor.get_restored_state:return"

  # Orchestrator - checkpoint state (refactored into orchestrator/core.py)
  - "src/elspeth/engine/orchestrator/core.py:Orchestrator._maybe_checkpoint:aggregation_state"

  # Protocols - row data in plugin interface
  - "src/elspeth/plugins/protocols.py:SinkProtocol.write:rows (list)"

  # Base classes - row data in plugin implementations
  - "src/elspeth/plugins/base.py:BaseSink.write:rows (list)"

  # Plugin utilities
  - "src/elspeth/plugins/utils.py:get_nested_field:data"

  # Sink plugins - row output (batch writes)
  - "src/elspeth/plugins/sinks/database_sink.py:DatabaseSink._ensure_table:row"
  - "src/elspeth/plugins/sinks/database_sink.py:DatabaseSink._create_columns_from_schema_or_row:row"
  - "src/elspeth/plugins/sinks/database_sink.py:DatabaseSink.write:rows (list)"
  - "src/elspeth/plugins/sinks/csv_sink.py:CSVSink.write:rows (list)"
  - "src/elspeth/plugins/sinks/csv_sink.py:CSVSink._open_file:rows (list)"
  - "src/elspeth/plugins/sinks/csv_sink.py:CSVSink._get_field_names_and_display:row"
  - "src/elspeth/plugins/sinks/json_sink.py:JSONSink.write:rows (list)"
  - "src/elspeth/plugins/sinks/json_sink.py:JSONSink._write_jsonl_batch:rows (list)"
  - "src/elspeth/plugins/sinks/json_sink.py:JSONSink._apply_display_headers:rows (list)"
  - "src/elspeth/plugins/sinks/json_sink.py:JSONSink._apply_display_headers:return (list)"

  # Source plugins - row validation
  - "src/elspeth/plugins/sources/json_source.py:JSONSource._validate_and_yield:row"

  # Pooling executor - row processing
  - "src/elspeth/plugins/pooling/executor.py:PooledExecutor.get_stats:return"
  - "src/elspeth/plugins/pooling/executor.py:PooledExecutor._execute_single:row"

  # ═══════════════════════════════════════════════════════════════════════════
  # PLUGIN CONFIG (TRUST BOUNDARY)
  # Plugin config comes from external YAML and is validated internally by
  # Pydantic schemas before use. The dict[str, Any] is the input type before
  # validation - our code validates it into typed Pydantic models.
  # ═══════════════════════════════════════════════════════════════════════════

  # Protocols - config input
  - "src/elspeth/plugins/protocols.py:SourceProtocol.__init__:config"
  - "src/elspeth/plugins/protocols.py:TransformProtocol.__init__:config"
  - "src/elspeth/plugins/protocols.py:SinkProtocol.__init__:config"
  - "src/elspeth/plugins/protocols.py:BatchTransformProtocol.__init__:config"

  # Base classes - config input
  - "src/elspeth/plugins/base.py:BaseTransform.__init__:config"
  - "src/elspeth/plugins/base.py:BaseSink.__init__:config"
  - "src/elspeth/plugins/base.py:BaseSource.__init__:config"
  - "src/elspeth/plugins/config_base.py:PluginConfig.from_dict:config"

  # Plugin implementations - config input
  - "src/elspeth/plugins/sinks/database_sink.py:DatabaseSink.__init__:config"
  - "src/elspeth/plugins/sinks/csv_sink.py:CSVSink.__init__:config"
  - "src/elspeth/plugins/sinks/json_sink.py:JSONSink.__init__:config"
  - "src/elspeth/plugins/transforms/passthrough.py:PassThrough.__init__:config"
  - "src/elspeth/plugins/transforms/field_mapper.py:FieldMapper.__init__:config"
  - "src/elspeth/plugins/transforms/batch_replicate.py:BatchReplicate.__init__:config"
  - "src/elspeth/plugins/transforms/batch_stats.py:BatchStats.__init__:config"
  - "src/elspeth/plugins/transforms/keyword_filter.py:KeywordFilter.__init__:config"
  - "src/elspeth/plugins/transforms/truncate.py:Truncate.__init__:config"
  - "src/elspeth/plugins/transforms/json_explode.py:JSONExplode.__init__:config"
  - "src/elspeth/plugins/transforms/web_scrape.py:WebScrapeTransform.__init__:options"
  - "src/elspeth/plugins/sources/json_source.py:JSONSource.__init__:config"
  - "src/elspeth/plugins/sources/csv_source.py:CSVSource.__init__:config"
  - "src/elspeth/plugins/sources/null_source.py:NullSource.__init__:config"

  # Plugin manager - factory methods for creating plugins from config
  - "src/elspeth/plugins/manager.py:PluginManager.create_source:config"
  - "src/elspeth/plugins/manager.py:PluginManager.create_transform:config"
  - "src/elspeth/plugins/manager.py:PluginManager.create_sink:config"

  # Plugin validation - config validation before plugin instantiation
  - "src/elspeth/plugins/validation.py:PluginConfigValidator.validate_source_config:config"
  - "src/elspeth/plugins/validation.py:PluginConfigValidator.validate_transform_config:config"
  - "src/elspeth/plugins/validation.py:PluginConfigValidator.validate_sink_config:config"
  - "src/elspeth/plugins/validation.py:PluginConfigValidator.validate_schema_config:schema_config"

  # CLI - plugin instantiation from configuration
  - "src/elspeth/cli.py:_build_resume_graphs:plugins"
  - "src/elspeth/cli_helpers.py:instantiate_plugins_from_config:return"
  - "src/elspeth/cli.py:_orchestrator_context:plugins"
  - "src/elspeth/cli.py:_execute_pipeline_with_instances:plugins"
  - "src/elspeth/cli.py:_execute_resume_with_instances:plugins"
  - "src/elspeth/cli.py:_load_raw_yaml:return"

  # Security - secrets loading from config (Tier 3 external config)
  - "src/elspeth/core/security/config_secrets.py:load_secrets_from_config:return (list)"

  # Config - runtime configuration dicts
  - "src/elspeth/core/config.py:resolve_config:return"
  - "src/elspeth/core/config.py:_expand_env_vars:config"
  - "src/elspeth/core/config.py:_expand_env_vars:return"
  - "src/elspeth/core/config.py:_fingerprint_secrets:options"
  - "src/elspeth/core/config.py:_fingerprint_secrets:return"
  - "src/elspeth/core/config.py:_expand_config_templates:raw_config"
  - "src/elspeth/core/config.py:_expand_config_templates:return"
  - "src/elspeth/core/config.py:_fingerprint_config_for_audit:config_dict"
  - "src/elspeth/core/config.py:_fingerprint_config_for_audit:return"
  - "src/elspeth/core/config.py:_expand_template_files:options"
  - "src/elspeth/core/config.py:_expand_template_files:return"
  - "src/elspeth/core/config.py:_recurse:d"
  - "src/elspeth/core/config.py:_recurse:return"

  # Canonical representation - deterministic JSON for hashing
  - "src/elspeth/core/canonical.py:_edge_to_canonical_dict:return"

  # DAG builder - schema dict extraction from node info
  - "src/elspeth/core/dag/builder.py:_best_schema_dict:return"

  # Schema reconstruction - deserializing schemas from landscape database (refactored into orchestrator/export.py)

  # ═══════════════════════════════════════════════════════════════════════════
  # AGGREGATION STATE
  # Aggregation plugins maintain arbitrary state between rows. The state format
  # is plugin-specific and cannot be typed at the framework level.
  # ═══════════════════════════════════════════════════════════════════════════
  - "src/elspeth/core/checkpoint/manager.py:CheckpointManager.create_checkpoint:aggregation_state"

  # ═══════════════════════════════════════════════════════════════════════════
  # PLUGIN CONTEXT - Recording and routing
  # PluginContext methods handle dynamic data from pipeline execution
  # ═══════════════════════════════════════════════════════════════════════════
  - "src/elspeth/contracts/plugin_context.py:PluginContext.get_checkpoint:return"
  - "src/elspeth/contracts/plugin_context.py:PluginContext.update_checkpoint:data"
  - "src/elspeth/contracts/plugin_context.py:PluginContext.record_call:request_data"
  - "src/elspeth/contracts/plugin_context.py:PluginContext.record_call:response_data"
  - "src/elspeth/contracts/plugin_context.py:PluginContext.record_call:error"
  - "src/elspeth/contracts/plugin_context.py:PluginContext.record_transform_error:row"

  # ═══════════════════════════════════════════════════════════════════════════
  # LANDSCAPE RECORDER MIXINS - Audit trail recording
  # The recorder was refactored into mixins; these methods handle dynamic
  # pipeline data from execution.
  # ═══════════════════════════════════════════════════════════════════════════

  # Run recording
  - "src/elspeth/core/landscape/_run_recording.py:RunRecordingMixin.begin_run:config"
  - "src/elspeth/core/landscape/_run_recording.py:RunRecordingMixin.record_secret_resolutions:resolutions (list)"

  # Node state recording
  - "src/elspeth/core/landscape/_node_state_recording.py:NodeStateRecordingMixin.begin_node_state:input_data"
  - "src/elspeth/core/landscape/_node_state_recording.py:NodeStateRecordingMixin.begin_node_state:context_before"
  - "src/elspeth/core/landscape/_node_state_recording.py:NodeStateRecordingMixin.complete_node_state:output_data"
  - "src/elspeth/core/landscape/_node_state_recording.py:NodeStateRecordingMixin.complete_node_state:context_after"

  # Token recording
  - "src/elspeth/core/landscape/_token_recording.py:TokenRecordingMixin.create_row:data"
  - "src/elspeth/core/landscape/_token_recording.py:TokenRecordingMixin.record_token_outcome:context"

  # Graph recording
  - "src/elspeth/core/landscape/_graph_recording.py:GraphRecordingMixin.register_node:config"

  # Error recording
  - "src/elspeth/core/landscape/_error_recording.py:ErrorRecordingMixin.record_transform_error:row_data"

  # Call recording
  - "src/elspeth/core/landscape/_call_recording.py:CallRecordingMixin.record_call:request_data"
  - "src/elspeth/core/landscape/_call_recording.py:CallRecordingMixin.record_call:response_data"
  - "src/elspeth/core/landscape/_call_recording.py:CallRecordingMixin.record_call:error"
  - "src/elspeth/core/landscape/_call_recording.py:CallRecordingMixin.begin_operation:input_data"
  - "src/elspeth/core/landscape/_call_recording.py:CallRecordingMixin.complete_operation:output_data"
  - "src/elspeth/core/landscape/_call_recording.py:CallRecordingMixin.record_operation_call:request_data"
  - "src/elspeth/core/landscape/_call_recording.py:CallRecordingMixin.record_operation_call:response_data"
  - "src/elspeth/core/landscape/_call_recording.py:CallRecordingMixin.record_operation_call:error"
  - "src/elspeth/core/landscape/_call_recording.py:CallRecordingMixin.get_call_response_data:return"

  # Operations tracking - source/sink I/O audit trail
  - "src/elspeth/core/operations.py:track_operation:input_data"

  # ═══════════════════════════════════════════════════════════════════════════
  # FORMATTERS - Record formatting for export
  # Formatters work with audit records that have dynamic structure
  # ═══════════════════════════════════════════════════════════════════════════
  - "src/elspeth/core/landscape/formatters.py:ExportFormatter.format:record"
  - "src/elspeth/core/landscape/formatters.py:ExportFormatter.format:return"
  - "src/elspeth/core/landscape/formatters.py:JSONFormatter.format:record"
  - "src/elspeth/core/landscape/formatters.py:CSVFormatter.flatten:record"
  - "src/elspeth/core/landscape/formatters.py:CSVFormatter.flatten:return"
  - "src/elspeth/core/landscape/formatters.py:CSVFormatter.format:record"
  - "src/elspeth/core/landscape/formatters.py:CSVFormatter.format:return"

  # ═══════════════════════════════════════════════════════════════════════════
  # EXPORTER - Record signing
  # Exporter works with dynamic audit records
  # ═══════════════════════════════════════════════════════════════════════════
  - "src/elspeth/core/landscape/exporter.py:LandscapeExporter._sign_record:record"

  # ═══════════════════════════════════════════════════════════════════════════
  # LLM PLUGINS - External API trust boundary
  # LLM transforms handle dynamic row data and external API responses
  # ═══════════════════════════════════════════════════════════════════════════

  # LLM templates
  - "src/elspeth/plugins/llm/templates.py:PromptTemplate.__init__:lookup_data"
  - "src/elspeth/plugins/llm/templates.py:PromptTemplate.render:row"
  - "src/elspeth/plugins/llm/templates.py:PromptTemplate.render_with_metadata:row"

  # LLM base
  - "src/elspeth/plugins/llm/base.py:BaseLLMTransform.__init__:config"

  # LLM multi-query
  - "src/elspeth/plugins/llm/multi_query.py:QuerySpec.build_template_context:row"
  - "src/elspeth/plugins/llm/multi_query.py:QuerySpec.build_template_context:return"
  - "src/elspeth/plugins/llm/multi_query.py:CaseStudyConfig.to_template_data:return"
  - "src/elspeth/plugins/llm/multi_query.py:CriterionConfig.to_template_data:return"

  # LLM tracing config
  - "src/elspeth/plugins/llm/tracing.py:parse_tracing_config:config"

  # Azure LLM (refactored: PipelineRow is now the row type at plugin boundary)
  - "src/elspeth/plugins/llm/azure.py:AzureLLMTransform.__init__:config"
  - "src/elspeth/plugins/llm/azure.py:AzureLLMTransform.azure_config:return"

  # Azure batch LLM
  - "src/elspeth/plugins/llm/azure_batch.py:AzureBatchLLMTransform.__init__:config"
  - "src/elspeth/plugins/llm/azure_batch.py:AzureBatchLLMTransform._get_checkpoint:return"
  - "src/elspeth/plugins/llm/azure_batch.py:AzureBatchLLMTransform._update_checkpoint:data"
  - "src/elspeth/plugins/llm/azure_batch.py:AzureBatchLLMTransform._check_batch_status:checkpoint"
  - "src/elspeth/plugins/llm/azure_batch.py:AzureBatchLLMTransform._download_results:checkpoint"
  - "src/elspeth/plugins/llm/azure_batch.py:AzureBatchLLMTransform.azure_config:return"

  # Azure multi-query LLM (refactored: PipelineRow is now the row type at plugin boundary)
  - "src/elspeth/plugins/llm/azure_multi_query.py:AzureMultiQueryLLMTransform.__init__:config"
  - "src/elspeth/plugins/llm/azure_multi_query.py:AzureMultiQueryLLMTransform._process_single_query:row"

  # OpenRouter LLM (refactored: PipelineRow is now the row type at plugin boundary)
  - "src/elspeth/plugins/llm/openrouter.py:OpenRouterLLMTransform.__init__:config"

  # ═══════════════════════════════════════════════════════════════════════════
  # AZURE PLUGINS - External cloud service trust boundary
  # ═══════════════════════════════════════════════════════════════════════════

  # Azure blob storage
  - "src/elspeth/plugins/azure/blob_source.py:AzureBlobSource.__init__:config"
  - "src/elspeth/plugins/azure/blob_sink.py:AzureBlobSink.__init__:config"
  - "src/elspeth/plugins/azure/blob_sink.py:AzureBlobSink._serialize_rows:rows (list)"
  - "src/elspeth/plugins/azure/blob_sink.py:AzureBlobSink._serialize_csv:rows (list)"
  - "src/elspeth/plugins/azure/blob_sink.py:AzureBlobSink._serialize_json:rows (list)"
  - "src/elspeth/plugins/azure/blob_sink.py:AzureBlobSink._serialize_jsonl:rows (list)"
  - "src/elspeth/plugins/azure/blob_sink.py:AzureBlobSink.write:rows (list)"
  - "src/elspeth/plugins/azure/blob_sink.py:AzureBlobSink._get_field_names_and_display:rows (list)"
  - "src/elspeth/plugins/azure/blob_sink.py:AzureBlobSink._apply_display_headers:rows (list)"
  - "src/elspeth/plugins/azure/blob_sink.py:AzureBlobSink._apply_display_headers:return (list)"

  # Azure content safety (refactored: PipelineRow is now the row type at plugin boundary)
  - "src/elspeth/plugins/transforms/azure/content_safety.py:AzureContentSafety.__init__:config"

  # Azure prompt shield (refactored: PipelineRow is now the row type at plugin boundary)
  - "src/elspeth/plugins/transforms/azure/prompt_shield.py:AzurePromptShield.__init__:config"

  # ═══════════════════════════════════════════════════════════════════════════
  # HTTP CLIENTS - External API trust boundary
  # ═══════════════════════════════════════════════════════════════════════════
  - "src/elspeth/plugins/clients/http.py:AuditedHTTPClient._record_and_emit:request_data"
  - "src/elspeth/plugins/clients/http.py:AuditedHTTPClient._record_and_emit:response_data"
  - "src/elspeth/plugins/clients/http.py:AuditedHTTPClient._record_and_emit:error_data"
  - "src/elspeth/plugins/clients/http.py:AuditedHTTPClient._execute_request:json"
  - "src/elspeth/plugins/clients/http.py:AuditedHTTPClient.post:json"
  - "src/elspeth/plugins/clients/replayer.py:ReplayMissError.__init__:request_data"
  - "src/elspeth/plugins/clients/replayer.py:CallReplayer.replay:request_data"
  - "src/elspeth/plugins/clients/verifier.py:CallVerifier.verify:request_data"
  - "src/elspeth/plugins/clients/verifier.py:CallVerifier.verify:live_response"

  # ═══════════════════════════════════════════════════════════════════════════
  # TUI - Display of dynamic audit data
  # ═══════════════════════════════════════════════════════════════════════════
  - "src/elspeth/tui/widgets/lineage_tree.py:LineageTree.get_tree_nodes:return (list)"
  - "src/elspeth/tui/widgets/lineage_tree.py:LineageTree._flatten_tree:result (list)"

  # Node detail panel - validation of JSON-parsed audit data (Tier 1 trust boundary)
  # These functions receive raw dicts from json.loads() and validate them into TypedDicts.
  # The input must be dict[str, Any] because it's the unvalidated type before validation.
  - "src/elspeth/tui/widgets/node_detail.py:_validate_execution_error:data"
  - "src/elspeth/tui/widgets/node_detail.py:_validate_transform_error:data"
  - "src/elspeth/tui/widgets/node_detail.py:_validate_artifact:data"

  # ═══════════════════════════════════════════════════════════════════════════
  # TELEMETRY EXPORTERS - External observability trust boundary
  # Exporter config comes from YAML and is validated internally. The configure()
  # method receives raw config before type validation.
  # ═══════════════════════════════════════════════════════════════════════════
  - "src/elspeth/telemetry/protocols.py:ExporterProtocol.configure:config"
  - "src/elspeth/telemetry/exporters/azure_monitor.py:AzureMonitorExporter.configure:config"
  - "src/elspeth/telemetry/exporters/azure_monitor.py:AzureMonitorExporter._serialize_event_attributes:return"
  - "src/elspeth/telemetry/exporters/otlp.py:OTLPExporter.configure:config"
  - "src/elspeth/telemetry/exporters/otlp.py:OTLPExporter._serialize_event_attributes:return"
  - "src/elspeth/telemetry/exporters/otlp.py:_SyntheticReadableSpan.__init__:attributes"
  - "src/elspeth/telemetry/exporters/console.py:ConsoleExporter.configure:config"
  - "src/elspeth/telemetry/exporters/console.py:ConsoleExporter._serialize_event:return"
  - "src/elspeth/telemetry/exporters/datadog.py:DatadogExporter.configure:config"

  # ═══════════════════════════════════════════════════════════════════════════
  # STRUCTLOG PROCESSORS - Framework boundary
  # Structlog defines the event_dict type as dict[str, Any]. Processors receive
  # and return this type as part of structlog's processing pipeline.
  # ═══════════════════════════════════════════════════════════════════════════
  - "src/elspeth/core/logging.py:_remove_internal_fields:event_dict"
  - "src/elspeth/core/logging.py:_remove_internal_fields:return"

  # ═══════════════════════════════════════════════════════════════════════════
  # MCP SERVER + ANALYZER - Genuinely dynamic patterns
  # SQL query results have user-defined columns; call_tool receives MCP protocol input.
  # All other MCP returns are now typed via TypedDicts in mcp/types.py.
  # ═══════════════════════════════════════════════════════════════════════════
  # Facade (mcp/analyzer.py) - delegates to submodules
  - "src/elspeth/mcp/analyzer.py:LandscapeAnalyzer.query:params"
  - "src/elspeth/mcp/analyzer.py:LandscapeAnalyzer.query:return (list)"
  # Submodule functions (mcp/analyzers/)
  - "src/elspeth/mcp/analyzers/queries.py:explain_token:return"
  - "src/elspeth/mcp/analyzers/queries.py:get_errors:return"
  - "src/elspeth/mcp/analyzers/queries.py:query:params"
  - "src/elspeth/mcp/analyzers/queries.py:query:return (list)"
  # MCP server machinery
  - "src/elspeth/mcp/server.py:call_tool:arguments"
  # _validate_tool_args bridges Tier 3 (MCP protocol) to validated args.
  # Input is dict[str, Any] by protocol; return is validated but dynamic per-tool.
  - "src/elspeth/mcp/server.py:_validate_tool_args:arguments"
  - "src/elspeth/mcp/server.py:_validate_tool_args:return"

  # ═══════════════════════════════════════════════════════════════════════════
  # TESTING UTILITIES - Test infrastructure (not production code)
  # Test factories accept arbitrary dicts for convenience — they wrap typed
  # constructors, so dict[str, Any] is the input type before factory conversion.
  # ═══════════════════════════════════════════════════════════════════════════
  - "src/elspeth/testing/__init__.py:make_pipeline_row:data"
  - "src/elspeth/testing/__init__.py:make_contract:data"
  - "src/elspeth/testing/__init__.py:make_row:data"
  - "src/elspeth/testing/__init__.py:make_source_row:data"
  - "src/elspeth/testing/__init__.py:make_source_row_quarantined:data"
  - "src/elspeth/testing/__init__.py:make_success:data"
  - "src/elspeth/testing/__init__.py:make_success:context_after"
  - "src/elspeth/testing/__init__.py:make_gate_continue:data"
  - "src/elspeth/testing/__init__.py:make_gate_route:data"
  - "src/elspeth/testing/__init__.py:make_gate_fork:data"
  - "src/elspeth/testing/__init__.py:make_token_info:data"
  - "src/elspeth/testing/__init__.py:make_row_result:data"
  - "src/elspeth/testing/__init__.py:make_pipeline_config:sinks"
  - "src/elspeth/testing/__init__.py:make_success_reason:metadata"
  - "src/elspeth/testing/__init__.py:make_success_reason:return"
  - "src/elspeth/testing/__init__.py:make_error_reason:return"
  - "src/elspeth/testing/__init__.py:make_contract_audit_record:data"

  # ═══════════════════════════════════════════════════════════════════════════
  # CHAOSLLM - Fault injection test server
  # ChaosLLM is a fault-injection test server for LLM reliability testing.
  # ═══════════════════════════════════════════════════════════════════════════
  - "src/elspeth/testing/chaosllm/server.py:ChaosLLMServer.get_stats:return"
  - "src/elspeth/testing/chaosllm/server.py:ChaosLLMServer.update_config:updates"
  - "src/elspeth/testing/chaosllm/server.py:ChaosLLMServer._get_current_config:return"
  - "src/elspeth/testing/chaosllm/server.py:ChaosLLMServer._handle_success_response:body"
  - "src/elspeth/testing/chaosllm/config.py:load_config:cli_overrides"
  - "src/elspeth/testing/chaosllm/config.py:load_preset:return"
  - "src/elspeth/testing/chaosllm/response_generator.py:OpenAIResponse.to_dict:return"
  - "src/elspeth/testing/chaosllm/response_generator.py:ResponseGenerator._generate_template_response:request"
  - "src/elspeth/testing/chaosllm/response_generator.py:ResponseGenerator._generate_echo_response:request"
  - "src/elspeth/testing/chaosllm/response_generator.py:ResponseGenerator._extract_prompt_text:request"
  - "src/elspeth/testing/chaosllm/response_generator.py:ResponseGenerator.generate:request"
  - "src/elspeth/testing/chaosllm/metrics.py:MetricsRecorder.get_stats:return"
  - "src/elspeth/testing/chaosllm/metrics.py:MetricsRecorder.get_requests:return (list)"
  - "src/elspeth/testing/chaosllm/metrics.py:MetricsRecorder.get_timeseries:return (list)"
  - "src/elspeth/testing/chaosllm/metrics.py:MetricsRecorder.export_data:return"
  - "src/elspeth/testing/chaosllm/server.py:ChaosLLMServer.export_metrics:return"
  - "src/elspeth/testing/chaosllm/server.py:ChaosLLMServer._handle_slow_response:body"

  # ChaosLLM MCP server (test tooling)
  - "src/elspeth/testing/chaosllm_mcp/server.py:ChaosLLMAnalyzer.diagnose:return"
  - "src/elspeth/testing/chaosllm_mcp/server.py:ChaosLLMAnalyzer.analyze_aimd_behavior:return"
  - "src/elspeth/testing/chaosllm_mcp/server.py:ChaosLLMAnalyzer.analyze_errors:return"
  - "src/elspeth/testing/chaosllm_mcp/server.py:ChaosLLMAnalyzer.analyze_latency:return"
  - "src/elspeth/testing/chaosllm_mcp/server.py:ChaosLLMAnalyzer.find_anomalies:return"
  - "src/elspeth/testing/chaosllm_mcp/server.py:ChaosLLMAnalyzer.get_burst_events:return"
  - "src/elspeth/testing/chaosllm_mcp/server.py:ChaosLLMAnalyzer.get_error_samples:return"
  - "src/elspeth/testing/chaosllm_mcp/server.py:ChaosLLMAnalyzer.get_time_window:return"
  - "src/elspeth/testing/chaosllm_mcp/server.py:ChaosLLMAnalyzer.query:return (list)"
  - "src/elspeth/testing/chaosllm_mcp/server.py:ChaosLLMAnalyzer.describe_schema:return"
  - "src/elspeth/testing/chaosllm_mcp/server.py:call_tool:arguments"
  - "src/elspeth/testing/chaosllm_mcp/server.py:ChaosLLMAnalyzer._avg_success:b_list (list)"
  - "src/elspeth/testing/chaosllm_mcp/server.py:ChaosLLMAnalyzer._avg_latency:b_list (list)"

  # ChaosEngine - shared utilities for chaos testing servers
  # MetricsStore returns dynamic dicts for stats/export (schema-driven SQLite).
  # Config loader uses dict[str, Any] for YAML config merging and preset loading.
  - "src/elspeth/testing/chaosengine/metrics_store.py:MetricsStore.get_stats:return"
  - "src/elspeth/testing/chaosengine/metrics_store.py:MetricsStore.export_data:return"
  - "src/elspeth/testing/chaosengine/metrics_store.py:MetricsStore.get_requests:return (list)"
  - "src/elspeth/testing/chaosengine/metrics_store.py:MetricsStore.get_timeseries:return (list)"
  - "src/elspeth/testing/chaosengine/config_loader.py:deep_merge:base"
  - "src/elspeth/testing/chaosengine/config_loader.py:deep_merge:override"
  - "src/elspeth/testing/chaosengine/config_loader.py:deep_merge:return"
  - "src/elspeth/testing/chaosengine/config_loader.py:load_config:cli_overrides"
  - "src/elspeth/testing/chaosengine/config_loader.py:load_preset:return"

  # ChaosWeb - fault-injection test server for web scraping resilience testing
  # Mirrors ChaosLLM patterns: YAML config loading, JSONL preset parsing, and
  # metrics/admin APIs return dynamic dicts (same pattern as ChaosLLM).
  - "src/elspeth/testing/chaosweb/config.py:load_preset:return"
  - "src/elspeth/testing/chaosweb/config.py:load_config:cli_overrides"
  - "src/elspeth/testing/chaosweb/server.py:ChaosWebServer.get_stats:return"
  - "src/elspeth/testing/chaosweb/server.py:ChaosWebServer.export_metrics:return"
  - "src/elspeth/testing/chaosweb/server.py:ChaosWebServer.update_config:updates"
  - "src/elspeth/testing/chaosweb/server.py:ChaosWebServer._get_current_config:return"
  - "src/elspeth/testing/chaosweb/metrics.py:WebMetricsRecorder.get_stats:return"
  - "src/elspeth/testing/chaosweb/metrics.py:WebMetricsRecorder.export_data:return"
  - "src/elspeth/testing/chaosweb/metrics.py:WebMetricsRecorder.get_requests:return (list)"
  - "src/elspeth/testing/chaosweb/metrics.py:WebMetricsRecorder.get_timeseries:return (list)"

  # ═══════════════════════════════════════════════════════════════════════════
  # BATCHING INFRASTRUCTURE - Row buffering for batch operations
  # ═══════════════════════════════════════════════════════════════════════════
  - "src/elspeth/plugins/batching/row_reorder_buffer.py:RowReorderBuffer.get_metrics:return"
  - "src/elspeth/plugins/batching/mixin.py:BatchTransformMixin.get_batch_metrics:return"

  # Azure blob sink - row serialization
  - "src/elspeth/plugins/azure/blob_sink.py:AzureBlobSink._get_fieldnames_from_schema_or_rows:rows (list)"

  # ═══════════════════════════════════════════════════════════════════════════
  # OPENROUTER MULTI-QUERY - External API trust boundary
  # ═══════════════════════════════════════════════════════════════════════════
  - "src/elspeth/plugins/llm/openrouter_multi_query.py:OpenRouterMultiQueryLLMTransform.__init__:config"
  - "src/elspeth/plugins/llm/openrouter_multi_query.py:OpenRouterMultiQueryLLMTransform._process_single_query:row"

  # Multi-query config base (JSON schema building for LLM structured output)
  - "src/elspeth/plugins/llm/multi_query.py:OutputFieldConfig.to_json_schema:return"
  - "src/elspeth/plugins/llm/multi_query.py:MultiQueryConfigMixin.parse_output_mapping:return"
  - "src/elspeth/plugins/llm/multi_query.py:MultiQueryConfigMixin.build_json_schema:return"
  - "src/elspeth/plugins/llm/multi_query.py:MultiQueryConfigMixin.build_response_format:return"

  # Base multi-query transform (shared row processing for Azure/OpenRouter)
  - "src/elspeth/plugins/llm/base_multi_query.py:BaseMultiQueryTransform._process_single_row_internal:row_for_queries"
  - "src/elspeth/plugins/llm/base_multi_query.py:BaseMultiQueryTransform._process_single_row_internal:row_data"
  - "src/elspeth/plugins/llm/base_multi_query.py:BaseMultiQueryTransform._execute_queries_parallel:row"
  - "src/elspeth/plugins/llm/base_multi_query.py:BaseMultiQueryTransform._execute_queries_sequential:row"
  - "src/elspeth/plugins/llm/base_multi_query.py:BaseMultiQueryTransform._process_single_query:row"

  # OpenRouter batch LLM (async batch API)
  - "src/elspeth/plugins/llm/openrouter_batch.py:OpenRouterBatchLLMTransform.__init__:config"
  - "src/elspeth/plugins/llm/openrouter_batch.py:OpenRouterBatchLLMTransform._process_single_row:return"
