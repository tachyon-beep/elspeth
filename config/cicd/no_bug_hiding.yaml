version: 1
defaults:
  fail_on_stale: true
  fail_on_expired: true
allow_hits:
- key: tui/screens/explain_screen.py:R4:ExplainScreen:_load_pipeline_structure:line=176
  owner: architecture
  reason: 'Trust boundary: loading pipeline structure that may fail for corrupt/incomplete runs'
  safety: Errors logged with exc_info; returns LoadingFailedState with error message
  expires: null
- key: tui/screens/explain_screen.py:R4:ExplainScreen:_load_node_state:line=277
  owner: architecture
  reason: 'Trust boundary: loading node state that may fail for invalid node_id or db issues'
  safety: Errors logged with exc_info; returns None (graceful degradation in TUI)
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=56
  owner: architecture
  reason: 'Optional field: state_id may be missing before execution'
  safety: Graceful degradation to 'N/A' - user sees partial data
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=59
  owner: architecture
  reason: 'Optional field: token_id may be missing before execution'
  safety: Graceful degradation to 'N/A' - user sees partial data
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=64
  owner: architecture
  reason: 'Optional field: status may be missing before execution'
  safety: Graceful degradation to 'N/A' - user sees partial data
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=67
  owner: architecture
  reason: 'Optional field: started_at may be missing before execution'
  safety: Graceful degradation to 'N/A' - user sees partial data
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=69
  owner: architecture
  reason: 'Optional field: completed_at may be missing before execution'
  safety: Graceful degradation to 'N/A' - user sees partial data
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=71
  owner: architecture
  reason: 'Optional field: duration_ms may be missing before execution'
  safety: Graceful degradation - conditionally displayed
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=78
  owner: architecture
  reason: 'Optional field: input_hash may be missing before execution'
  safety: Graceful degradation to '(none)' - user sees partial data
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=79
  owner: architecture
  reason: 'Optional field: output_hash may be missing before execution'
  safety: Graceful degradation to '(none)' - user sees partial data
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=86
  owner: architecture
  reason: 'Optional field: error_json may be missing'
  safety: Graceful degradation - error section conditionally shown
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=98
  owner: architecture
  reason: 'Trust boundary: displaying error type from JSON that may be malformed'
  safety: Graceful degradation to 'unknown' - user sees partial error info
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=99
  owner: architecture
  reason: 'Trust boundary: displaying error message from JSON that may be malformed'
  safety: Graceful degradation to 'unknown' - user sees partial error info
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=110
  owner: architecture
  reason: 'Trust boundary: state_id lookup for logging context'
  safety: None is safe - just means unknown state_id in log message
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=119
  owner: architecture
  reason: 'Optional field: artifact may be missing for non-sink nodes'
  safety: Graceful degradation - artifact section conditionally shown
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=125
  owner: architecture
  reason: 'Trust boundary: displaying artifact_id that may be malformed'
  safety: Graceful degradation to 'N/A' - user sees partial artifact info
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=126
  owner: architecture
  reason: 'Trust boundary: displaying path_or_uri that may be malformed'
  safety: Graceful degradation to 'N/A' - user sees partial artifact info
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=127
  owner: architecture
  reason: 'Trust boundary: displaying content_hash that may be malformed'
  safety: Graceful degradation to 'N/A' - user sees partial artifact info
  expires: null
- key: tui/widgets/node_detail.py:R1:NodeDetailPanel:render_content:line=131
  owner: architecture
  reason: 'Trust boundary: displaying size_bytes that may be malformed'
  safety: Graceful degradation - conditionally displayed
  expires: null
- key: plugins/manager.py:R3:_schema_hash:line=50
  owner: architecture
  reason: 'Trust boundary: checking if plugin class has Pydantic model_fields'
  safety: Raises TypeError if not Pydantic - fails fast on protocol violation
  expires: null
- key: plugins/manager.py:R2:PluginSpec:from_plugin:line=94
  owner: architecture
  reason: 'Polymorphic: sources don''t have input_schema, sinks don''t have output_schema'
  safety: Legitimate Optional return - None means 'accepts any schema'
  expires: null
- key: plugins/manager.py:R2:PluginSpec:from_plugin:line=95
  owner: architecture
  reason: 'Polymorphic: sources don''t have input_schema, sinks don''t have output_schema'
  safety: Legitimate Optional return - None means 'accepts any schema'
  expires: null
- key: contracts/data.py:R1:validate_row:line=101
  owner: architecture
  reason: 'Trust boundary: Pydantic error dict may not have ''input'' key'
  safety: Graceful handling - validation error message still produced
  expires: null
- key: contracts/schema.py:R1:SchemaConfig:from_dict:line=275
  owner: architecture
  reason: 'Round-trip serialization: to_dict() outputs mode=''dynamic'', from_dict() must accept it'
  safety: Explicit check for serialized form before standard parsing - enables audit trail storage
  expires: null
- key: contracts/schema.py:R1:SchemaConfig:from_dict:line=271
  owner: architecture
  reason: 'Optional field: guaranteed_fields is not present in all schema configs'
  safety: _parse_field_names_list handles None correctly - returns None
  expires: null
- key: contracts/schema.py:R1:SchemaConfig:from_dict:line=272
  owner: architecture
  reason: 'Optional field: required_fields is not present in all schema configs'
  safety: _parse_field_names_list handles None correctly - returns None
  expires: null
- key: contracts/data.py:R3:_type_name:line=212
  owner: architecture
  reason: 'Type introspection: not all types have __name__ attribute'
  safety: Graceful fallback to str() - error message still produced
  expires: null
- key: contracts/data.py:R1:check_compatibility:line=184
  owner: architecture
  reason: 'Framework boundary: Pydantic model_config may not have ''extra'' key (uses default)'
  safety: Missing key returns None, which != "forbid", correctly treated as permissive
  expires: null
- key: engine/retry.py:R1:RetryConfig:from_policy:line=80
  owner: architecture
  reason: 'Trust boundary: external policy dict may have invalid/missing values'
  safety: max() ensures minimum valid value, docstring documents this behavior
  expires: null
- key: engine/retry.py:R1:RetryConfig:from_policy:line=81
  owner: architecture
  reason: 'Trust boundary: external policy dict may have invalid/missing values'
  safety: max() ensures minimum valid value, docstring documents this behavior
  expires: null
- key: engine/retry.py:R1:RetryConfig:from_policy:line=82
  owner: architecture
  reason: 'Trust boundary: external policy dict may have invalid/missing values'
  safety: max() ensures minimum valid value, docstring documents this behavior
  expires: null
- key: engine/retry.py:R1:RetryConfig:from_policy:line=83
  owner: architecture
  reason: 'Trust boundary: external policy dict may have invalid/missing values'
  safety: max() ensures minimum valid value, docstring documents this behavior
  expires: null
- key: core/config.py:R1:_expand_env_vars:_expand_string:replacer:line=787
  owner: architecture
  reason: 'Trust boundary: environment variables are external input that may not exist'
  safety: Explicit None check follows; falls back to default or keeps original for later error
  expires: null
- key: core/config.py:R1:_fingerprint_config_for_audit:line=1052
  owner: architecture
  reason: 'Optional env var: ELSPETH_ALLOW_RAW_SECRETS is not required in production'
  safety: Missing env var = empty string = False = production mode (fail-closed)
  expires: null
- key: plugins/clients/llm.py:R1:LLMResponse:total_tokens:line=45
  owner: architecture
  reason: 'Trust boundary: LLM API usage dict may not include all token counts'
  safety: Graceful default to 0 - total_tokens is convenience property, not critical
  expires: null
- key: plugins/clients/llm.py:R3:AuditedLLMClient:chat_completion:line=303
  owner: architecture
  reason: 'SDK version compatibility: older OpenAI SDK versions lack model_dump()'
  safety: None fallback is safe - older SDKs still record summary fields (content, model, usage)
  expires: null
- key: plugins/clients/http.py:R1:AuditedHTTPClient:post:line=227
  owner: architecture
  reason: 'Trust boundary: HTTP response headers from external server may lack content-type'
  safety: Graceful default to empty string - treats as non-JSON, still records body
  expires: null
- key: plugins/llm/azure_batch.py:R3:AzureBatchLLMTransform:_get_checkpoint:line=284
  owner: architecture
  reason: 'Capability check: verify checkpoint API exists before using it'
  safety: Raises RuntimeError if method doesn't exist - fail-fast, not silent degradation
  expires: null
- key: plugins/llm/azure_batch.py:R3:AzureBatchLLMTransform:_update_checkpoint:line=301
  owner: architecture
  reason: 'Capability check: verify checkpoint API exists before using it'
  safety: Raises RuntimeError if method doesn't exist - fail-fast, not silent degradation
  expires: null
- key: plugins/llm/azure_batch.py:R3:AzureBatchLLMTransform:_clear_checkpoint:line=317
  owner: architecture
  reason: 'Capability check: verify checkpoint API exists before using it'
  safety: Raises RuntimeError if method doesn't exist - fail-fast, not silent degradation
  expires: null
- key: plugins/llm/azure_batch.py:R1:AzureBatchLLMTransform:_process_batch:line=265
  owner: architecture
  reason: Checkpoint may be None or empty dict - checking for batch_id existence
  safety: None/missing batch_id means PHASE 1 (fresh submit), explicit logic follows
  expires: null
- key: plugins/llm/azure_batch.py:R4:AzureBatchLLMTransform:_submit_batch:line=415
  owner: architecture
  reason: 'Trust boundary: Azure files.create API call (external system boundary)'
  safety: Caught, recorded via ctx.record_call(ERROR), returns TransformResult.error(retryable=True)
  expires: null
- key: plugins/llm/azure_batch.py:R4:AzureBatchLLMTransform:_submit_batch:line=454
  owner: architecture
  reason: 'Trust boundary: Azure batches.create API call (external system boundary)'
  safety: Caught, recorded via ctx.record_call(ERROR), returns TransformResult.error(retryable=True)
  expires: null
- key: plugins/llm/azure_batch.py:R4:AzureBatchLLMTransform:_check_batch_status:line=534
  owner: architecture
  reason: 'Trust boundary: Azure batches.retrieve API call (external system boundary)'
  safety: Caught, recorded via ctx.record_call(ERROR), returns TransformResult.error(retryable=True)
  expires: null
- key: plugins/llm/azure_batch.py:R4:AzureBatchLLMTransform:_download_results:line=662
  owner: architecture
  reason: 'Trust boundary: Azure files.content API call (external system boundary)'
  safety: Caught, recorded via ctx.record_call(ERROR), returns TransformResult.error(retryable=True)
  expires: null
- key: plugins/llm/azure_batch.py:R2:AzureBatchLLMTransform:_check_batch_status:line=530
  owner: architecture
  reason: 'Trust boundary: Azure batch.output_file_id only exists on completed batches'
  safety: Recorded as None in audit trail - field is informational only
  expires: null
- key: plugins/llm/azure_batch.py:R3:AzureBatchLLMTransform:_check_batch_status:line=566
  owner: architecture
  reason: 'Trust boundary: Azure batch.errors may not exist on all batch statuses'
  safety: Graceful handling - error info still returned without detailed errors
  expires: null
- key: plugins/llm/azure_batch.py:R1:AzureBatchLLMTransform:_check_batch_status:line=594
  owner: architecture
  reason: submitted_at may not exist in old checkpoint format
  safety: Missing submitted_at skips timeout check - graceful degradation
  expires: null
- key: plugins/llm/azure_batch.py:R1:AzureBatchLLMTransform:_download_results:line=639
  owner: architecture
  reason: row_mapping may not exist in corrupted checkpoint
  safety: Empty dict default allows graceful recovery - rows return with error
  expires: null
- key: plugins/llm/azure_batch.py:R1:AzureBatchLLMTransform:_download_results:line=640
  owner: architecture
  reason: template_errors may not exist in old checkpoint format
  safety: Empty list default means no template errors tracked - graceful degradation
  expires: null
- key: plugins/llm/azure_batch.py:R1:AzureBatchLLMTransform:_download_results:line=698
  owner: architecture
  reason: 'Trust boundary: Azure JSONL result custom_id field validated as external data'
  safety: None check follows on next line - returns error row if missing
  expires: null
- key: plugins/llm/azure_batch.py:R1:AzureBatchLLMTransform:_download_results:line=740
  owner: architecture
  reason: 'Intentional Optional API: rows with template errors aren''t in mapping'
  safety: None is checked explicitly on next line with 'if custom_id is None'
  expires: null
- key: plugins/llm/azure_batch.py:R1:AzureBatchLLMTransform:_download_results:line=756
  owner: architecture
  reason: 'Trust boundary: Azure batch result ''error'' field is optional'
  safety: Graceful handling - checks for error before extracting response
  expires: null
- key: plugins/llm/azure_batch.py:R1:AzureBatchLLMTransform:_download_results:line=768
  owner: architecture
  reason: 'Trust boundary: Azure batch result ''response'' field structure varies'
  safety: Graceful default to {} - handles missing/malformed responses
  expires: null
- key: plugins/llm/azure_batch.py:R1:AzureBatchLLMTransform:_download_results:line=769
  owner: architecture
  reason: 'Trust boundary: Azure batch response ''body'' field may be missing'
  safety: Graceful default to {} - handles missing/malformed responses
  expires: null
- key: plugins/llm/azure_batch.py:R1:AzureBatchLLMTransform:_download_results:line=770
  owner: architecture
  reason: 'Trust boundary: Azure batch response ''choices'' field may be missing'
  safety: Graceful default to [] - explicit check for empty choices follows
  expires: null
- key: plugins/llm/azure_batch.py:R1:AzureBatchLLMTransform:_download_results:line=773
  owner: architecture
  reason: 'Trust boundary: Azure choice message.content structure may vary'
  safety: Graceful default to empty string - empty content is valid for audit trail
  expires: null
- key: plugins/llm/azure_batch.py:R1:AzureBatchLLMTransform:_download_results:line=774
  owner: architecture
  reason: 'Trust boundary: Azure response usage field is optional'
  safety: Graceful default to {} - usage is metadata, not critical
  expires: null
- key: plugins/discovery.py:R2:_discover_in_file:line=125
  owner: architecture
  reason: 'Trust boundary: scanning arbitrary classes that may or may not have ''name'' attribute'
  safety: Classes without valid name are skipped with warning log - discovery continues
  expires: null
- key: plugins/discovery.py:R2:get_plugin_description:line=232
  owner: architecture
  reason: 'UI display fallback: generating human-readable description for classes without ''name'' attr'
  safety: Falls back to class __name__ for display - no control flow or audit impact
  expires: null
- key: cli.py:R1:_execute_pipeline:_format_run_completed:line=578
  owner: architecture
  reason: 'Intentional Optional API: status_symbols lookup with default for unknown statuses'
  safety: Default '?' symbol for unrecognized statuses - output still produced
  expires: null
- key: core/events.py:R1:EventBus:emit:line=83
  owner: architecture
  reason: 'Intentional Optional API: checking subscription presence, not hiding missing keys'
  safety: Empty list default means 'no subscribers' - documented behavior, events are decoupled
  expires: null
- key: core/security/fingerprint.py:R1:get_fingerprint_key:line=77
  owner: architecture
  reason: 'Trust boundary: ELSPETH_FINGERPRINT_KEY is optional external input (dev mode)'
  safety: 'Explicit check: if not set, falls through to Key Vault check or raises ValueError'
  expires: null
- key: core/security/fingerprint.py:R1:get_fingerprint_key:line=82
  owner: architecture
  reason: 'Trust boundary: ELSPETH_KEYVAULT_URL is optional external input (production mode)'
  safety: 'Explicit check: if not set, raises ValueError with guidance on configuration'
  expires: null
- key: core/security/fingerprint.py:R1:get_fingerprint_key:line=84
  owner: architecture
  reason: 'Trust boundary: ELSPETH_KEYVAULT_SECRET_NAME is optional with sensible default'
  safety: Default 'elspeth-fingerprint-key' used when not set - documented behavior
  expires: null
- key: contracts/results.py:R3:ArtifactDescriptor:for_database:line=239
  owner: architecture
  reason: 'Security boundary: enforce SanitizedDatabaseUrl to prevent credentials in audit trail'
  safety: Raises TypeError with guidance to use SanitizedDatabaseUrl.from_raw_url()
  expires: null
- key: contracts/results.py:R3:ArtifactDescriptor:for_webhook:line=270
  owner: architecture
  reason: 'Security boundary: enforce SanitizedWebhookUrl to prevent tokens in audit trail'
  safety: Raises TypeError with guidance to use SanitizedWebhookUrl.from_raw_url()
  expires: null
- key: plugins/validation.py:R4:PluginConfigValidator:validate_schema_config:line=229
  owner: architecture
  reason: 'Trust boundary: SchemaConfig.from_dict may raise ValueError or other exceptions from field
    parsing'
  safety: Converts to structured ValidationError - unexpected errors still reported to caller
  expires: null
- key: plugins/validation.py:R1:PluginConfigValidator:_extract_errors:line=349
  owner: architecture
  reason: 'Trust boundary: Pydantic error dict structure from external library - ''input'' field is optional'
  safety: Graceful default to '<unknown>' - error message still produced with field and message
  expires: null
- key: plugins/azure/blob_source.py:R4:AzureBlobSource:_load_csv:line=383
  owner: architecture
  reason: 'Trust boundary: CSV parsing can fail in many ways (encoding, malformed data, etc.)'
  safety: Logged and row quarantined with full error details
  expires: null
- key: core/dag.py:R1:ExecutionGraph:_validate_single_edge:line=975
  owner: architecture
  reason: 'Framework boundary: Pydantic model_config may not have ''extra'' key (uses default)'
  safety: Missing key returns None, which != "allow", correctly treated as not-dynamic
  expires: null
- key: core/dag.py:R1:ExecutionGraph:_validate_single_edge:line=976
  owner: architecture
  reason: 'Framework boundary: Pydantic model_config may not have ''extra'' key (uses default)'
  safety: Missing key returns None, which != "allow", correctly treated as not-dynamic
  expires: null
- key: core/dag.py:R1:ExecutionGraph:_get_schema_config_from_node:line=1095
  owner: architecture
  reason: 'Trust boundary: not all node configs have schema field (depends on node type)'
  safety: Returns None when schema not present - calling code handles None appropriately
  expires: null
- key: core/dag.py:R1:ExecutionGraph:_get_required_fields:line=1156
  owner: architecture
  reason: 'Optional field: required_input_fields is not present in all transform configs'
  safety: Returns None when not present, then checks options dict for aggregations
  expires: null
- key: core/dag.py:R1:ExecutionGraph:_get_required_fields:line=1162
  owner: architecture
  reason: 'Aggregation config structure: options is nested dict for aggregation nodes'
  safety: Default {} when options missing - then checks for required_input_fields inside
  expires: null
- key: core/dag.py:R1:ExecutionGraph:_get_required_fields:line=1164
  owner: architecture
  reason: 'Optional field: required_input_fields may not be in aggregation options'
  safety: Returns frozenset of fields if present, falls through to schema check if not
  expires: null
- key: engine/executors.py:R3:TransformExecutor:_get_batch_adapter:line=156
  owner: architecture
  reason: 'Optional protocol extension: checking if transform supports batch adapter pattern'
  safety: Fallback to non-batch processing if attribute missing
  expires: null
- key: engine/executors.py:R2:TransformExecutor:_get_batch_adapter:line=162
  owner: architecture
  reason: 'Optional protocol extension: pool_size is optional on batch-aware transforms'
  safety: Default value 30 is safe - used for concurrency limiting
  expires: null
- key: engine/executors.py:R3:TransformExecutor:execute_transform:line=233
  owner: architecture
  reason: 'Optional protocol extension: checking if transform has accept() method'
  safety: Non-batch transforms use process() instead - documented fallback
  expires: null
- key: engine/executors.py:R2:TransformExecutor:execute_transform:line=233
  owner: architecture
  reason: 'Optional protocol extension: accept method check paired with hasattr'
  safety: Callable check ensures method is usable if present
  expires: null
- key: engine/executors.py:R2:TransformExecutor:execute_transform:line=274
  owner: architecture
  reason: 'Optional protocol extension: batch_wait_timeout is optional on transforms'
  safety: Default 3600.0 seconds is generous timeout for batch results
  expires: null
- key: engine/executors.py:R2:TransformExecutor:execute_transform:line=304
  owner: architecture
  reason: 'Optional protocol extension: evict_submission is optional on batch transforms'
  safety: None means transform doesn't support submission eviction - gracefully skipped
  expires: null
- key: engine/executors.py:R4:TransformExecutor:execute_transform:line=308
  owner: architecture
  reason: 'Best-effort cleanup: evict_submission failure should not block timeout handling'
  safety: Logged with warning - original timeout error still raised
  expires: null
- key: plugins/batching/mixin.py:R4:BatchTransformMixin:_process_and_complete:line=231
  owner: architecture
  reason: 'Trust boundary: batch processing can fail for many reasons (API errors, timeouts)'
  safety: Caught, logged, and result emitted with error status for audit trail
  expires: null
- key: plugins/batching/mixin.py:R4:BatchTransformMixin:_release_loop:line=288
  owner: architecture
  reason: 'Background thread cleanup: iteration failure should not crash release loop'
  safety: Logged with error, loop continues to process remaining results
  expires: null
- key: plugins/batching/mixin.py:R4:BatchTransformMixin:_release_loop:line=301
  owner: architecture
  reason: 'Background thread emit: emit failure should not crash release loop'
  safety: Logged with error, loop continues - waiter will timeout if emit fails
  expires: null
- key: core/landscape/database.py:R1:LandscapeDB:_validate_schema:line=137
  owner: architecture
  reason: 'Trust boundary: SQLAlchemy inspector FK dict structure from external library'
  safety: Graceful handling of missing fields in FK metadata
  expires: null
- key: engine/executors.py:R1:GateExecutor:execute_gate:line=539
  owner: architecture
  reason: Lookup with explicit None check - raises MissingEdgeError if not found
  safety: Raises immediately with node_id and label for debugging
  expires: null
- key: engine/executors.py:R1:GateExecutor:_record_routing:line=838
  owner: architecture
  reason: Lookup with explicit None check - raises MissingEdgeError if not found
  safety: Raises immediately with node_id and label for debugging
  expires: null
- key: engine/executors.py:R1:GateExecutor:_record_routing:line=852
  owner: architecture
  reason: Lookup with explicit None check - raises MissingEdgeError if not found
  safety: Raises immediately with node_id and label for debugging
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:buffer_row:line=943
  owner: architecture
  reason: Checking if batch exists to decide whether to create one
  safety: None means create new batch - explicit conditional logic follows
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:buffer_row:line=968
  owner: architecture
  reason: Optional trigger evaluator lookup - not all aggregations have config
  safety: None means no trigger config - correctly skipped
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:get_buffered_rows:line=981
  owner: architecture
  reason: 'Intentional Optional API: returns empty list for unknown node_id'
  safety: Empty list is safe default - no rows buffered yet
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:get_buffered_tokens:line=992
  owner: architecture
  reason: 'Intentional Optional API: returns empty list for unknown node_id'
  safety: Empty list is safe default - no tokens buffered yet
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:_get_buffered_data:line=1007
  owner: architecture
  reason: 'Intentional Optional API: returns empty list for unknown node_id'
  safety: Empty list is safe default - no rows buffered
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:_get_buffered_data:line=1008
  owner: architecture
  reason: 'Intentional Optional API: returns empty list for unknown node_id'
  safety: Empty list is safe default - no tokens buffered
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:execute_flush:line=1042
  owner: architecture
  reason: 'Explicit existence check: raises RuntimeError if batch_id is None'
  safety: Raises immediately with node_id for debugging
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:execute_flush:line=1047
  owner: architecture
  reason: Existence check paired with explicit RuntimeError if empty
  safety: Raises immediately if buffer is empty
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:execute_flush:line=1048
  owner: architecture
  reason: Token buffer lookup matches row buffer lookup pattern
  safety: Empty list default paired with row buffer check
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:get_batch_id:line=1438
  owner: architecture
  reason: 'Intentional Optional API: returns None if no batch exists for node_id'
  safety: None return is expected API behavior
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:should_flush:line=1449
  owner: architecture
  reason: 'Intentional Optional API: returns False if no evaluator exists for node_id'
  safety: False return is safe default - no flush needed
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:get_trigger_type:line=1463
  owner: architecture
  reason: 'Intentional Optional API: returns None if no evaluator exists for node_id'
  safety: None return is expected API behavior
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:check_flush_status:line=1483
  owner: architecture
  reason: 'Intentional Optional API: returns (False, None) if no evaluator exists for node_id'
  safety: False return is safe default - no flush needed when no trigger config
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:get_restored_state:line=1515
  owner: architecture
  reason: 'Intentional Optional API: returns None if no state was restored for node_id'
  safety: None return is expected API behavior
  expires: null
- key: engine/executors.py:R4:SinkExecutor:write:line=1740
  owner: architecture
  reason: 'Post-durability callbacks: checkpoint callback fails after durable sink write'
  safety: Logged with error - sink artifact exists but checkpoint failed, resume will replay
  expires: null
- key: plugins/llm/openrouter.py:R1:OpenRouterLLMTransform:_process_row:line=301
  owner: architecture
  reason: 'Trust boundary (Tier 3): HTTP response headers may not include content-type'
  safety: Graceful default to 'unknown' - used for error reporting only
  expires: null
- key: plugins/llm/openrouter.py:R1:OpenRouterLLMTransform:_process_row:line=328
  owner: architecture
  reason: 'Trust boundary (Tier 3): OpenRouter API usage field is optional in response'
  safety: Graceful default to {} - usage is metadata, not critical for processing
  expires: null
- key: plugins/llm/openrouter.py:R1:OpenRouterLLMTransform:_process_row:line=340
  owner: architecture
  reason: 'Trust boundary (Tier 3): OpenRouter API may return different model than requested'
  safety: Graceful fallback to requested model - audit still captures actual value
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:execute_flush:line=1225
  owner: architecture
  reason: Optional trigger evaluator lookup - not all aggregations have trigger config
  safety: None means no trigger config - correctly skipped
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:_reset_batch_state:line=1237
  owner: architecture
  reason: 'Idempotent cleanup: batch_id may not exist if already reset'
  safety: None means already cleaned up or never existed - correctly skipped
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:get_buffer_count:line=1252
  owner: architecture
  reason: 'Intentional Optional API: returns 0 for unknown node_id'
  safety: 0 is safe default - no rows buffered
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:get_checkpoint_state:line=1292
  owner: architecture
  reason: Optional trigger evaluator lookup for elapsed time - not all aggregations have trigger config
  safety: None means no trigger config - elapsed_age_seconds defaults to 0.0
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:get_checkpoint_state:line=1306
  owner: architecture
  reason: 'Intentional Optional API: batch_id lookup for node_id'
  safety: None is safe - means no batch exists yet, recorded as null in checkpoint
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:restore_from_checkpoint:line=1354
  owner: architecture
  reason: 'Optional field: _version in checkpoint state for migration compatibility'
  safety: None check with explicit fallback to legacy format
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:restore_from_checkpoint:line=1403
  owner: architecture
  reason: 'Optional field: branch_name in TokenInfo is None by default (not forked)'
  safety: None default handled by dataclass
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:restore_from_checkpoint:line=1412
  owner: architecture
  reason: 'Optional field: batch_id may not exist in checkpoint (fresh buffer)'
  safety: None check with explicit handling
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:restore_from_checkpoint:line=1418
  owner: architecture
  reason: Optional trigger evaluator lookup - node may not have trigger config
  safety: None check with conditional elapsed time restoration
  expires: null
- key: engine/executors.py:R1:AggregationExecutor:restore_from_checkpoint:line=1428
  owner: architecture
  reason: 'Optional field: elapsed_age_seconds for Bug #6 timeout preservation (backward compat)'
  safety: Default 0.0 if missing - safe for fresh checkpoints
  expires: null
- key: plugins/base.py:R1:BaseGate:__init__:line=164
  owner: architecture
  reason: 'Optional field: fork_to validated by GateSettings schema - None when gate does not fork'
  safety: Schema validation guarantees valid type; .get() appropriate for optional field
  expires: null
- key: plugins/sinks/database_sink.py:R1:DatabaseSink:__init__:line=95
  owner: architecture
  reason: 'Trust boundary: environment variable ELSPETH_ALLOW_RAW_SECRETS is external config'
  safety: Default empty string when unset is intentional; enables dev mode without fingerprint key
  expires: null
- key: plugins/clients/http.py:R1:AuditedHTTPClient:_filter_request_headers:line=112
  owner: architecture
  reason: 'Trust boundary: environment variable ELSPETH_ALLOW_RAW_SECRETS is external config'
  safety: Default empty string when unset is intentional; enables dev mode without fingerprint key (consistent with config.py and database_sink.py)
  expires: null
# CLI status_symbols lookups (shifted due to routed_destinations feature)
- key: cli.py:R1:_execute_pipeline_with_instances:_format_run_completed:line=799
  owner: architecture
  reason: 'Intentional Optional API: status_symbols lookup with default for unknown statuses'
  safety: Default '?' symbol for unrecognized statuses - output still produced
  expires: null
- key: cli.py:R1:_execute_resume_with_instances:_format_run_completed:line=1238
  owner: architecture
  reason: 'Intentional Optional API: status_symbols lookup with default for unknown statuses'
  safety: Default '?' symbol for unrecognized statuses - output still produced
  expires: null
# CLI health command - environment variables and external system checks
- key: cli.py:R1:health:line=1633
  owner: architecture
  reason: 'Trust boundary: environment variable GIT_COMMIT_SHA is optional external input'
  safety: Empty string default is safe - commit SHA is informational only
  expires: null
- key: cli.py:R4:health:line=1645
  owner: architecture
  reason: 'Trust boundary: git subprocess may fail for many reasons (not installed, not a repo, etc.)'
  safety: Graceful fallback to 'unknown' - health check reports git as unavailable
  expires: null
- key: cli.py:R1:health:line=1661
  owner: architecture
  reason: 'Trust boundary: environment variable DATABASE_URL is optional external input'
  safety: Empty string default triggers skip logic - database check only runs if configured
  expires: null
- key: cli.py:R4:health:line=1673
  owner: architecture
  reason: 'Trust boundary: database connection may fail for many reasons (network, auth, etc.)'
  safety: Error recorded in checks dict with status='error' - health check reports DB as unhealthy
  expires: null
- key: cli.py:R4:health:line=1737
  owner: architecture
  reason: 'Trust boundary: plugin manager initialization may fail due to misconfiguration'
  safety: Error recorded in checks dict with status='error' - health check reports plugins as unhealthy
  expires: null
# Orchestrator cleanup and routed_destinations counting
- key: engine/orchestrator.py:R4:Orchestrator:_cleanup_transforms:line=238
  owner: architecture
  reason: 'Cleanup path exception: best-effort plugin close() in finally block - crash would prevent other plugins from cleanup'
  safety: Errors logged with full details, then raised after all cleanups attempted
  expires: null
# _execute_run: routed_destinations counter accumulation (6 usages)
- key: engine/orchestrator.py:R1:Orchestrator:_execute_run:line=1083
  owner: architecture
  reason: 'Counter accumulation pattern: routed_destinations counts sinks dynamically discovered during timeout flush'
  safety: Default 0 for missing sink names is correct - first route to a sink initializes counter
  expires: null
- key: engine/orchestrator.py:R1:Orchestrator:_execute_run:line=1116
  owner: architecture
  reason: 'Counter accumulation pattern: routed_destinations counts sinks dynamically discovered during execution'
  safety: Default 0 for missing sink names is correct - first route to a sink initializes counter
  expires: null
- key: engine/orchestrator.py:R1:Orchestrator:_execute_run:line=1183
  owner: architecture
  reason: 'Counter accumulation pattern: routed_destinations counts sinks dynamically discovered during execution'
  safety: Default 0 for missing sink names is correct - first route to a sink initializes counter
  expires: null
- key: engine/orchestrator.py:R1:Orchestrator:_execute_run:line=1255
  owner: architecture
  reason: 'Counter accumulation pattern: routed_destinations counts sinks dynamically discovered during timeout flush'
  safety: Default 0 for missing sink names is correct - first route to a sink initializes counter
  expires: null
- key: engine/orchestrator.py:R1:Orchestrator:_execute_run:line=1293
  owner: architecture
  reason: 'Counter accumulation pattern: routed_destinations counts sinks dynamically discovered during execution'
  safety: Default 0 for missing sink names is correct - first route to a sink initializes counter
  expires: null
# _process_resumed_rows: routed_destinations counter accumulation (5 usages)
- key: engine/orchestrator.py:R1:Orchestrator:_process_resumed_rows:line=2044
  owner: architecture
  reason: 'Counter accumulation pattern: routed_destinations counts sinks dynamically discovered during timeout flush'
  safety: Default 0 for missing sink names is correct - first route to a sink initializes counter
  expires: null
- key: engine/orchestrator.py:R1:Orchestrator:_process_resumed_rows:line=2069
  owner: architecture
  reason: 'Counter accumulation pattern: routed_destinations counts sinks dynamically discovered during execution'
  safety: Default 0 for missing sink names is correct - first route to a sink initializes counter
  expires: null
- key: engine/orchestrator.py:R1:Orchestrator:_process_resumed_rows:line=2125
  owner: architecture
  reason: 'Counter accumulation pattern: routed_destinations counts sinks dynamically discovered during execution'
  safety: Default 0 for missing sink names is correct - first route to a sink initializes counter
  expires: null
- key: engine/orchestrator.py:R1:Orchestrator:_process_resumed_rows:line=2172
  owner: architecture
  reason: 'Counter accumulation pattern: routed_destinations counts sinks dynamically discovered during timeout flush'
  safety: Default 0 for missing sink names is correct - first route to a sink initializes counter
  expires: null
- key: engine/orchestrator.py:R1:Orchestrator:_process_resumed_rows:line=2208
  owner: architecture
  reason: 'Counter accumulation pattern: routed_destinations counts sinks dynamically discovered during execution'
  safety: Default 0 for missing sink names is correct - first route to a sink initializes counter
  expires: null
# _check_aggregation_timeouts: routed_destinations counter for timeout-triggered downstream routing
- key: engine/orchestrator.py:R1:Orchestrator:_check_aggregation_timeouts:line=2489
  owner: architecture
  reason: 'Counter accumulation pattern: routed_destinations counts sinks dynamically discovered during timeout flush downstream processing'
  safety: Default 0 for missing sink names is correct - first route to a sink initializes counter
  expires: null
# _flush_remaining_aggregation_buffers: routed_destinations counter for end-of-source flush downstream routing
- key: engine/orchestrator.py:R1:Orchestrator:_flush_remaining_aggregation_buffers:line=2658
  owner: architecture
  reason: 'Counter accumulation pattern: routed_destinations counts sinks dynamically discovered during end-of-source flush downstream processing'
  safety: Default 0 for missing sink names is correct - first route to a sink initializes counter
  expires: null
# OpenRouter multi-query external API responses (Tier 3 trust boundary)
- key: plugins/llm/openrouter_multi_query.py:R1:OpenRouterMultiQueryLLMTransform:_process_single_query:line=533
  owner: architecture
  reason: 'Trust boundary (Tier 3): HTTP response headers from external server may lack content-type'
  safety: Graceful default to 'unknown' - used for error reporting only
  expires: null
- key: plugins/llm/openrouter_multi_query.py:R1:OpenRouterMultiQueryLLMTransform:_process_single_query:line=566
  owner: architecture
  reason: 'Trust boundary (Tier 3): OpenRouter API usage field is optional in response'
  safety: Graceful default to {} - usage is metadata, not critical for processing
  expires: null
- key: plugins/llm/openrouter_multi_query.py:R1:OpenRouterMultiQueryLLMTransform:_process_single_query:line=571
  owner: architecture
  reason: 'Trust boundary (Tier 3): OpenRouter API completion_tokens may be missing in usage dict'
  safety: Default 0 skips truncation check - truncation detected later via JSON parse failure
  expires: null
- key: plugins/llm/openrouter_multi_query.py:R1:OpenRouterMultiQueryLLMTransform:_process_single_query:line=584
  owner: architecture
  reason: 'Trust boundary (Tier 3): OpenRouter API prompt_tokens is informational in error response'
  safety: Default 0 in error metadata - does not affect control flow
  expires: null
- key: plugins/llm/openrouter_multi_query.py:R1:OpenRouterMultiQueryLLMTransform:_process_single_query:line=659
  owner: architecture
  reason: 'Trust boundary (Tier 3): OpenRouter API may return different model than requested'
  safety: Graceful fallback to configured model - audit still captures actual value
  expires: null
# MCP Server - handles external data from MCP clients (Tier 3)
- key: mcp/server.py:R3:_dataclass_to_dict:line=58
  owner: architecture
  reason: 'Standard Python idiom: checking for dataclass __dataclass_fields__ attribute'
  safety: This is the canonical way to detect dataclasses; alternatives require importing typing
  expires: null
- key: mcp/server.py:R3:_dataclass_to_dict:line=63
  owner: architecture
  reason: 'Standard Python idiom: checking nested values for dataclass fields'
  safety: Part of recursive dataclass serialization - same pattern as line 58
  expires: null
- key: mcp/server.py:R3:_dataclass_to_dict:line=67
  owner: architecture
  reason: 'Standard Python idiom: checking for Enum .value attribute'
  safety: Enum detection for JSON serialization - converts to string representation
  expires: null
- key: mcp/server.py:R1:LandscapeAnalyzer:get_performance_report:line=655
  owner: architecture
  reason: 'Counter accumulation pattern: failures_by_node may not have entry for all nodes'
  safety: Default 0 for nodes without failures is correct behavior
  expires: null
- key: mcp/server.py:R1:LandscapeAnalyzer:describe_schema:line=888
  owner: architecture
  reason: 'Framework boundary: SQLAlchemy inspector column dict may not have nullable key'
  safety: Default True for nullable is safe - matches SQL default
  expires: null
- key: mcp/server.py:R1:LandscapeAnalyzer:describe_schema:line=894
  owner: architecture
  reason: 'Framework boundary: SQLAlchemy inspector PK constraint dict structure varies'
  safety: Empty list default is safe for tables without primary keys
  expires: null
- key: mcp/server.py:R1:LandscapeAnalyzer:get_recent_activity:line=1359
  owner: architecture
  reason: 'Counter accumulation pattern: status_counts initialized empty and populated dynamically'
  safety: Default 0 for first occurrence of each status is correct initialization
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1636
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: Default values match tool schema; MCP client may omit optional args
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1637
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: None is valid for optional status filter
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1648
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: Default 100 matches tool schema
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1649
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: Default 0 matches tool schema
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1654
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: None is valid for optional row_id filter
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1655
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: Default 100 matches tool schema
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1660
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: None is valid - token_id or row_id, not both required
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1661
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: None is valid - token_id or row_id, not both required
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1662
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: None is valid for optional sink disambiguator
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1667
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: Default "all" matches tool schema
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1668
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: Default 100 matches tool schema
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1673
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: None is valid for optional node_id filter
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1674
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: None is valid for optional status filter
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1675
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: Default 100 matches tool schema
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1682
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: None is valid for optional SQL parameters
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1703
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: Default 10 matches tool schema
  expires: null
- key: mcp/server.py:R1:create_server:call_tool:line=1707
  owner: architecture
  reason: 'Trust boundary (Tier 3): MCP arguments from external client - optional parameters'
  safety: Default 60 matches tool schema
  expires: null
- key: mcp/server.py:R4:create_server:call_tool:line=1714
  owner: architecture
  reason: 'MCP server boundary: must catch all exceptions and return error to client'
  safety: Error message returned to MCP client; server continues running for next request
  expires: null
- key: mcp/server.py:R1:main:line=1756
  owner: architecture
  reason: 'Trust boundary: environment variable ELSPETH_DATABASE_URL is optional external input'
  safety: Explicit check follows - exits with error message if neither arg nor env var provided
  expires: null
