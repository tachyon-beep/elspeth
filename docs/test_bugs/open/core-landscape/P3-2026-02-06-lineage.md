# Test Bug Report: Fix weak assertions in lineage

## Summary

- This test file provides comprehensive coverage of the `explain()` lineage query functionality, including fork disambiguation, sink routing, and critical audit integrity checks. Most tests follow good patterns with real database setup (LandscapeDB.in_memory()) rather than mocking. However, there are two tests at the end that test for expected behavior that may not be implemented yet, and some tests have redundant imports.

## Severity

- Severity: trivial
- Priority: P3
- Verdict: **KEEP**

## Reporter

- Name or handle: Test Audit
- Date: 2026-02-06
- Audit file: docs/test_audit/tests_core_landscape_test_lineage.audit.md

## Test File

- **File:** `tests/core/landscape/test_lineage`
- **Lines:** 653
- **Test count:** 16

## Findings

- See audit file for details


## Verdict Detail

**KEEP** - This is a high-value test file that thoroughly tests the lineage query functionality including critical audit integrity scenarios. The warnings about database manipulation tests are noted but these tests are testing real edge cases that matter for audit integrity. The file would benefit from consolidating imports at module level for consistency, but this does not affect test validity. The tests covering "crashes on missing parent" scenarios are particularly valuable as they enforce the CLAUDE.md Tier 1 trust model.

## Proposed Fix

- [ ] Weak assertions strengthened
- [ ] Redundant tests consolidated
- [ ] Test intent clearly expressed in assertions

## Tests

- Run after fix: `.venv/bin/python -m pytest tests/core/landscape/test_lineage -v`

## Notes

- Source audit: `docs/test_audit/tests_core_landscape_test_lineage.audit.md`
