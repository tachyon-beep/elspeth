file,lines,status,warning_count,observation_count,recommendation
src/elspeth/plugins/sinks/json_sink.py,537,CRITICAL,5,1,"The JSON array truncate-then-write pattern (Critical finding) is a data loss risk that must be addressed before this code handles emergency dispatc..."
src/elspeth/core/security/web.py,84,CRITICAL,2,3,"(1) Fix the DNS rebinding TOCTOU vulnerability by ensuring the HTTP client uses the pre-validated IP address rather than performing independent DNS..."
src/elspeth/cli.py,2417,NEEDS_REFACTOR,6,5,"(1) Delete the dead `_execute_pipeline` function (lines 675-985) immediately -- it violates the No Legacy Code Policy. (2) Extract event formatter ..."
src/elspeth/plugins/llm/openrouter_multi_query.py,1253,NEEDS_REFACTOR,6,6,"1. **Immediate (Critical):** Fix the `None` content crash at line 846 by adding a null check before `.strip()`. Fix `expand_queries()` to pass `cri..."
src/elspeth/telemetry/exporters/datadog.py,333,NEEDS_REFACTOR,4,1,"(1) The global environment variable mutation must be addressed -- either save and restore the original values on close, or use a ddtrace API that a..."
src/elspeth/plugins/llm/azure_batch.py,1261,NEEDS_ATTENTION,8,5,"Three items require immediate attention before production use:"
src/elspeth/core/config.py,1598,NEEDS_ATTENTION,7,7,"1. **(High priority)** Add `extra = ""forbid""` to `ElspethSettings` and all Settings models that directly accept user YAML input. This is the sing..."
src/elspeth/engine/processor.py,2004,NEEDS_ATTENTION,7,7,"Three priorities:"
src/elspeth/mcp/server.py,2355,NEEDS_ATTENTION,7,4,"The SQL keyword blocklist in `query()` needs to be replaced with a word-boundary-aware check (e.g., regex `\bCREATE\b`) to eliminate false positive..."
src/elspeth/core/landscape/recorder.py,3233,NEEDS_ATTENTION,6,7,"1. Fix the TOCTOU race in `complete_operation()` by combining the validation read and status update into a single transaction (use `WHERE status = ..."
src/elspeth/engine/executors.py,2235,NEEDS_ATTENTION,6,8,"Address the warnings in priority order:"
src/elspeth/engine/orchestrator/core.py,2319,NEEDS_ATTENTION,6,8,"1. **Fix immediately:** Missing `rows_succeeded` increments in `_process_resumed_rows()` coalesce-timeout handlers (lines 2120 and 2139). These are..."
src/elspeth/engine/orchestrator/export.py,346,NEEDS_ATTENTION,6,4,"(1) Add try/finally around sink operations in JSON export to ensure cleanup on failure. (2) Consider whether export sinks should receive a landscap..."
src/elspeth/testing/chaosllm/server.py,747,NEEDS_ATTENTION,6,3,"The highest priority items are (1) the SSTI vulnerability via X-Fake-Template header, which should use `jinja2.SandboxedEnvironment` instead of `ji..."
src/elspeth/core/dag.py,1364,NEEDS_ATTENTION,5,6,"Three items should be addressed before release:"
src/elspeth/core/landscape/database.py,327,NEEDS_ATTENTION,5,3,"(1) Add `PRAGMA busy_timeout=5000` to `_configure_sqlite()` -- this is the most impactful fix and addresses a real production failure mode. (2) Con..."
src/elspeth/core/landscape/schema.py,506,NEEDS_ATTENTION,5,5,"(1) Add a primary key to `batch_members` -- either a `PrimaryKeyConstraint(""batch_id"", ""token_id"")` (replacing the UniqueConstraint) or a surro..."
src/elspeth/core/rate_limit/limiter.py,270,NEEDS_ATTENTION,5,4,"The global excepthook replacement at import time is the primary concern. Consider deferring the hook installation until the first `RateLimiter` is ..."
src/elspeth/plugins/azure/blob_sink.py,637,NEEDS_ATTENTION,5,3,"Replace `Environment` with `SandboxedEnvironment` for blob path rendering (defense-in-depth against SSTI). Fix the exception re-raise pattern to us..."
src/elspeth/plugins/clients/http.py,683,NEEDS_ATTENTION,5,2,"(1) Refactor post/get into a shared internal `_execute_request()` method to eliminate duplication. (2) Create a persistent httpx.Client in `__init_..."
src/elspeth/plugins/context.py,511,NEEDS_ATTENTION,5,5,"(1) Either implement `route_to_sink()` properly or remove it and remove the call from the executor -- the current state is misleading dead code. (2..."
src/elspeth/plugins/llm/azure.py,759,NEEDS_ATTENTION,5,5,"Fix the race condition in `_get_underlying_client()` (C1) by adding lock protection consistent with `_get_llm_client()`. Evaluate whether the contr..."
src/elspeth/plugins/llm/azure_multi_query.py,1089,NEEDS_ATTENTION,5,6,"Fix the critical sequential path bug where retryable `LLMClientError` (NetworkError, ServerError) is not caught in `_execute_queries_sequential()`...."
src/elspeth/plugins/llm/openrouter.py,719,NEEDS_ATTENTION,5,6,"The `max_tokens` truthiness check (C2) should be changed to `if self._max_tokens is not None` for correctness parity with Azure. The HTTP client cr..."
src/elspeth/plugins/sinks/database_sink.py,407,NEEDS_ATTENTION,5,3,"The double serialization (Critical finding) should be fixed by computing canonical JSON once and deriving both the hash and the size from the same ..."
src/elspeth/plugins/transforms/azure/content_safety.py,526,NEEDS_ATTENTION,5,5,"Two issues require immediate attention: (1) The fail-open category mapping must be replaced with an explicit lookup table that rejects unknown cate..."
src/elspeth/plugins/transforms/azure/prompt_shield.py,459,NEEDS_ATTENTION,5,5,"Three issues require immediate attention: (1) The API request structure should be redesigned to properly distinguish user prompt fields from docume..."
src/elspeth/plugins/transforms/web_scrape.py,293,NEEDS_ATTENTION,5,3,"Three issues require remediation: (1) The SSRF TOCTOU vulnerability needs a fundamental fix -- either pin DNS resolution and pass the resolved IP t..."
src/elspeth/telemetry/exporters/otlp.py,417,NEEDS_ATTENTION,5,3,"(1) Add type validation for config parameters (`batch_size`, `headers`, `endpoint`) to match the validation rigor of the Azure Monitor exporter. (2..."
src/elspeth/telemetry/manager.py,428,NEEDS_ATTENTION,5,2,"Fix the race condition on `_last_logged_drop_count` in `_dispatch_to_exporters` by either (a) holding `_dropped_lock` for the entire aggregate logg..."
src/elspeth/testing/chaosllm/metrics.py,848,NEEDS_ATTENTION,5,3,"Fix the `close()` method to track and close all thread connections (requires maintaining a thread-safe registry of connections). Address the race c..."
src/elspeth/testing/chaosllm_mcp/server.py,1071,NEEDS_ATTENTION,5,5,"(1) Replace the SQL keyword blocklist with a proper approach -- either use `sqlite3.connect(..., readonly=True)` (available in Python 3.12+ via URI..."
src/elspeth/tui/widgets/lineage_tree.py,197,NEEDS_ATTENTION,5,4,"(1) The linear transform chain assumption should be documented as a known limitation or refactored to support DAG display (using edge data from the..."
src/elspeth/contracts/config/runtime.py,598,NEEDS_ATTENTION,4,4,"1. Add NaN/Infinity rejection to `_validate_float_field` (critical -- this can cause silent data corruption in retry timing)."
src/elspeth/contracts/errors.py,803,NEEDS_ATTENTION,4,5,"Remove the backwards-compatibility `branches_arrived` field from `CoalesceFailureReason` per the No Legacy Code Policy. The other findings are desi..."
src/elspeth/core/checkpoint/recovery.py,472,NEEDS_ATTENTION,4,4,"The `.get()` calls on aggregation state (lines 292-295) should be replaced with direct key access per the Data Manifesto's Tier 1 trust model. The ..."
src/elspeth/core/landscape/exporter.py,537,NEEDS_ATTENTION,4,3,"Address the residual N+1 query patterns in batch members (lines 468-491) and operation calls (lines 233-270) to bring them in line with the Bug 76r..."
src/elspeth/core/landscape/lineage.py,217,NEEDS_ATTENTION,4,5,"(1) The N+1 query pattern for routing events and calls (lines 157-166) should be optimized with batch queries using an IN clause over the set of st..."
src/elspeth/core/retention/purge.py,443,NEEDS_ATTENTION,4,4,"The TOCTOU race (warning #1) should be documented and either accepted as a known limitation or mitigated by changing the purge loop to use `delete(..."
src/elspeth/engine/coalesce_executor.py,903,NEEDS_ATTENTION,4,6,"1. Add `first` policy handling to `check_timeouts` (raise RuntimeError like `flush_pending` does) -- this is a straightforward fix that prevents si..."
src/elspeth/engine/expression_parser.py,583,NEEDS_ATTENTION,4,9,"1. Fix the mutable operator allowlists (known P2 bug) -- use `types.MappingProxyType` wrapping."
src/elspeth/engine/orchestrator/aggregation.py,433,NEEDS_ATTENTION,4,4,"(1) Extract the duplicated outcome-handling logic into a shared helper function to ensure consistent behavior and reduce maintenance risk. (2) Revi..."
src/elspeth/plugins/azure/blob_source.py,735,NEEDS_ATTENTION,4,3,"Address the unbounded memory allocation (critical for production safety), fix the exception re-raise pattern to avoid constructor mismatches, and m..."
src/elspeth/plugins/batching/mixin.py,408,NEEDS_ATTENTION,4,3,"The release loop exception handler (lines 288-310) should be hardened to handle the case where `entry.result` unpack fails, by assigning sentinel v..."
src/elspeth/plugins/clients/llm.py,457,NEEDS_ATTENTION,4,3,"(1) Replace string-based error classification with structured error inspection (check for `status_code` attribute on OpenAI exceptions, or use `isi..."
src/elspeth/plugins/clients/verifier.py,283,NEEDS_ATTENTION,4,3,"(1) Add a threading.Lock if the verifier will be used in thread-pool contexts. (2) Add a counter for the ""call never had response"" case (case 3) ..."
src/elspeth/plugins/llm/openrouter_batch.py,783,NEEDS_ATTENTION,4,4,"(1) Verify thread-safety of `ctx.record_call()` and `landscape.allocate_call_index()` when called from ThreadPoolExecutor workers with a shared con..."
src/elspeth/plugins/pooling/executor.py,479,NEEDS_ATTENTION,4,4,"Fix the three confirmed P2 bugs (stats accumulation, dispatch gate pacing, shutdown). The `_shutdown` flag issue should be addressed as part of the..."
src/elspeth/plugins/protocols.py,665,NEEDS_ATTENTION,4,4,"(1) Remove `PluginProtocol` or actually use it to enforce the common attributes across all plugin protocols. (2) Add `close()` to `CoalesceProtocol..."
src/elspeth/plugins/sinks/csv_sink.py,617,NEEDS_ATTENTION,4,3,"The content hash semantics in append mode (Critical finding) should be clarified -- either document that the hash represents cumulative file state ..."
src/elspeth/plugins/sources/csv_source.py,305,NEEDS_ATTENTION,4,5,"Change `strict=False` to `strict=True` on line 243 as a defense-in-depth measure. The remaining warnings are low-severity and can be tracked as bac..."
src/elspeth/plugins/sources/json_source.py,335,NEEDS_ATTENTION,4,4,"(1) Add empty-source contract locking after the yield-from calls in `load()`, mirroring CSVSource lines 278-282. This is the highest priority fix. ..."
src/elspeth/plugins/transforms/batch_stats.py,208,NEEDS_ATTENTION,4,3,"(1) Add overflow protection for `sum()` -- check if `total` is finite after computation. (2) Re-evaluate the `group_by` design: either validate tha..."
src/elspeth/plugins/transforms/keyword_filter.py,176,NEEDS_ATTENTION,4,5,"(1) Add ReDoS protection -- either use a regex timeout (via a wrapper), pre-screen patterns for backtracking potential, or document the risk promin..."
src/elspeth/testing/chaosllm/cli.py,565,NEEDS_ATTENTION,4,3,"Rename the local `app` variable on line 375 to avoid shadowing. Verify whether `uvicorn.run()` works correctly with `workers > 1` when passed an ap..."
src/elspeth/testing/chaosllm/config.py,541,NEEDS_ATTENTION,4,5,"Add a model validator to `BurstConfig` ensuring `duration_sec <= interval_sec` (or at minimum a warning). Consider adding documentation or a warnin..."
src/elspeth/tui/screens/explain_screen.py,401,NEEDS_ATTENTION,4,5,"(1) Include GATE, AGGREGATION, and COALESCE node types in the lineage display (map them into the transforms list or add separate categories). (2) C..."
src/elspeth/cli_helpers.py,159,NEEDS_ATTENTION,3,4,"The `getattr` defensive pattern at line 54 should be evaluated against the transform protocol. If `is_batch_aware` is a required attribute on trans..."
src/elspeth/contracts/contract_propagation.py,209,NEEDS_ATTENTION,3,3,"Fix the inconsistent exception handling in `propagate_contract` (add `ValueError` to the except clause at line 54). Extract shared field inference ..."
src/elspeth/contracts/contract_records.py,284,NEEDS_ATTENTION,3,4,"(1) Extract the duplicated type maps (`TYPE_MAP` in this file, `type_map` in `SchemaContract.from_checkpoint()`, `VALID_FIELD_TYPES` in `schema_con..."
src/elspeth/contracts/data.py,280,NEEDS_ATTENTION,3,4,"(1) The missing generic container type handling in `_types_compatible()` should be evaluated -- determine if any current or planned schemas use `li..."
src/elspeth/contracts/results.py,572,NEEDS_ATTENTION,3,7,"(1) Add output data invariant validation to `TransformResult.__post_init__` to match the pattern already used for `success_reason`. (2) Replace `_e..."
src/elspeth/contracts/schema_contract.py,705,NEEDS_ATTENTION,3,5,"The `_by_original` collision issue (W1) should be addressed with either uniqueness validation or a documented policy for collision handling. The ve..."
src/elspeth/contracts/url.py,239,NEEDS_ATTENTION,3,4,"Fix the hostname=None bug at line 238 -- either add a guard `if parsed.hostname is None: raise ValueError(...)` or handle it as `netloc = port_str`..."
src/elspeth/core/canonical.py,277,NEEDS_ATTENTION,3,5,"Address the unhandled type passthrough on line 116 by raising an explicit `TypeError` with ELSPETH context for types that cannot be normalized, rat..."
src/elspeth/core/checkpoint/manager.py,252,NEEDS_ATTENTION,3,5,"The `get_checkpoints()` method should either validate compatibility for each checkpoint (consistent with `get_latest_checkpoint()`) or be clearly d..."
src/elspeth/core/landscape/formatters.py,229,NEEDS_ATTENTION,3,4,"(1) Change `dataclass_to_dict` to return `None` for `None` input instead of `{}`. This is a semantic fix that prevents callers from confusing ""abs..."
src/elspeth/core/landscape/journal.py,215,NEEDS_ATTENTION,3,4,"(1) The silent self-disabling behavior is the most concerning issue. At minimum, the disabled state should be logged periodically or at shutdown, n..."
src/elspeth/core/landscape/repositories.py,579,NEEDS_ATTENTION,3,5,"(1) Remove or refactor the unused `session` parameter from all repository constructors -- it is dead code that misleads readers. (2) Add type valid..."
src/elspeth/core/payload_store.py,145,NEEDS_ATTENTION,3,3,"Address the non-atomic write in `store()` using a write-to-temp-then-rename pattern. This eliminates both the crash corruption window and the concu..."
src/elspeth/core/security/config_secrets.py,183,NEEDS_ATTENTION,3,3,"(1) The plaintext secret values in resolution records should be cleared after fingerprinting -- either by mutating the records to delete the `secre..."
src/elspeth/core/security/secret_loader.py,301,NEEDS_ATTENTION,3,3,"(1) Address the AzureResourceNotFoundError fallback on line 191 -- it should raise ImportError immediately if azure.core is not available rather th..."
src/elspeth/engine/batch_adapter.py,227,NEEDS_ATTENTION,3,5,"(1) `clear()` should signal all pending waiters before clearing state, to prevent 300-second hangs during abnormal shutdown. (2) The `wait()` succe..."
src/elspeth/engine/retry.py,146,NEEDS_ATTENTION,3,4,"The primary issue is that `on_retry` is never wired in RowProcessor, meaning individual retry attempts are not audited. This should be addressed ei..."
src/elspeth/plugins/azure/auth.py,229,NEEDS_ATTENTION,3,3,"Replace `str | None` with `SecretStr | None` for `connection_string`, `sas_token`, and `client_secret` fields to prevent credential exposure in log..."
src/elspeth/plugins/base.py,506,NEEDS_ATTENTION,3,6,"(1) Consider making `BaseTransform.process()` abstract, with a separate `BaseBatchTransform` class for batch-aware transforms that makes the batch ..."
src/elspeth/plugins/batching/examples.py,212,NEEDS_ATTENTION,3,3,"(1) Fix the `TransformOutputAdapter.emit()` signature in Example 4 to include `state_id: str | None`. (2) Either complete the `OutputPortSinkAdapte..."
src/elspeth/plugins/clients/replayer.py,255,NEEDS_ATTENTION,3,4,"(1) Add a threading.Lock around `_sequence_counters` and `_cache` access in `replay()`, or document that the replayer must be used single-threaded...."
src/elspeth/plugins/discovery.py,281,NEEDS_ATTENTION,3,4,"(1) Consider converting `EXCLUDED_FILES` from a deny-list to an allow-list or marker-based approach to prevent silent exclusion of new plugins. (2)..."
src/elspeth/plugins/llm/base.py,374,NEEDS_ATTENTION,3,3,"The primary concern is the behavioral divergence between `BaseLLMTransform.process()` and the concrete subclass `_process_row()` methods (W1). The ..."
src/elspeth/plugins/llm/multi_query.py,351,NEEDS_ATTENTION,3,6,"(1) Extract multi-query fields (`case_studies`, `criteria`, `output_mapping`, `response_format`) and methods (`build_json_schema`, `build_response_..."
src/elspeth/plugins/manager.py,331,NEEDS_ATTENTION,3,4,"(1) Remove gate-related dead code (get_gates, get_gate_by_name, create_gate, and gate iteration in _refresh_caches). (2) Address the double-validat..."
src/elspeth/plugins/transforms/batch_replicate.py,194,NEEDS_ATTENTION,3,4,"(1) Change `raw_copies < 1` from raising ValueError to returning TransformResult.error() per trust model -- this is row data, not a code bug. (2) U..."
src/elspeth/plugins/transforms/json_explode.py,220,NEEDS_ATTENTION,3,5,"(1) Use `copy.deepcopy(base)` for each output row instead of `base.copy()` to prevent cross-row mutation of nested fields. (2) Deep-copy array elem..."
src/elspeth/plugins/transforms/web_scrape_extraction.py,58,NEEDS_ATTENTION,3,3,"(1) Apply `strip_elements` before the `format=""raw""` early return, or document that `raw` format intentionally bypasses stripping and validate th..."
src/elspeth/plugins/validation.py,355,NEEDS_ATTENTION,3,3,"(1) Add missing transforms to `_get_transform_config_model()`: `openrouter_batch_llm`, `openrouter_multi_query_llm`, `web_scrape`. (2) Consider ref..."
src/elspeth/testing/chaosllm/error_injector.py,488,NEEDS_ATTENTION,3,3,"Fix the RNG thread-safety issue. The simplest approach would be to either (a) use a `threading.Lock` around all RNG access in `decide()`, or (b) do..."
src/elspeth/testing/chaosllm/response_generator.py,603,NEEDS_ATTENTION,3,3,"Replace `jinja2.Environment` with `jinja2.SandboxedEnvironment` to mitigate the SSTI vulnerability. Add a validation check for the `selection` para..."
src/elspeth/tui/explain_app.py,123,NEEDS_ATTENTION,3,3,"(1) Either implement token_id/row_id filtering or remove the parameters to avoid misleading the CLI integration. (2) Fix `action_refresh` to check ..."
src/elspeth/contracts/audit.py,685,NEEDS_ATTENTION,2,9,"1. Add `__post_init__` validation to `NonCanonicalMetadata` for documented invariants (Warning)."
src/elspeth/contracts/enums.py,271,NEEDS_ATTENTION,2,5,"(1) Remove `BackpressureMode.SLOW` entirely per the No Legacy Code policy -- it is not implemented, and its presence creates a misleading API. If/w..."
src/elspeth/contracts/identity.py,55,NEEDS_ATTENTION,2,4,"The mutability of `row_id` and `token_id` is a latent risk. Consider either (a) making `TokenInfo` a frozen dataclass (since `with_updated_data` al..."
src/elspeth/contracts/transform_contract.py,141,NEEDS_ATTENTION,2,3,"Add `datetime` to `_TYPE_MAP` (and import it from `datetime`). This is a one-line fix that aligns this file with `VALID_FIELD_TYPES` and `ALLOWED_C..."
src/elspeth/contracts/type_normalization.py,89,NEEDS_ATTENTION,2,4,"(1) Fix the misleading ""Must match type_map"" comment on line 20-21 to accurately describe the relationship with `VALID_FIELD_TYPES` and explain w..."
src/elspeth/core/landscape/__init__.py,151,NEEDS_ATTENTION,2,2,"Add the 6 missing table re-exports to both the import block and `__all__` list to maintain consistency with `schema.py`. This is a minor cleanup ta..."
src/elspeth/core/landscape/reproducibility.py,155,NEEDS_ATTENTION,2,3,"The read-modify-write race condition in `update_grade_after_purge` should use `SELECT ... FOR UPDATE` (or equivalent) for PostgreSQL deployments. T..."
src/elspeth/engine/tokens.py,382,NEEDS_ATTENTION,2,4,"(1) Add an assertion in `coalesce_tokens` validating that all parent row_ids match and that the parents list is non-empty. This is the highest prio..."
src/elspeth/plugins/config_base.py,397,NEEDS_ATTENTION,2,4,"Remove the legacy `display_headers` and `restore_source_headers` fields from `SinkPathConfig` per the No Legacy Code Policy. Migrate all sink imple..."
src/elspeth/plugins/llm/validation.py,74,NEEDS_ATTENTION,2,4,"1. (C1) Fix the NaN/Infinity acceptance bug per the existing P1 bug report. This is the highest-priority item."
src/elspeth/plugins/transforms/web_scrape_errors.py,110,NEEDS_ATTENTION,2,3,"(1) Rename `TimeoutError` to `HTTPTimeoutError` or `RequestTimeoutError` to avoid shadowing the Python built-in. (2) Consider removing unused error..."
src/elspeth/plugins/transforms/web_scrape_fingerprint.py,42,NEEDS_ATTENTION,2,4,"(1) Add explicit validation for unknown mode values -- raise `ValueError` for any mode not in `{""content"", ""full"", ""structure""}`. (2) Either ..."
src/elspeth/telemetry/buffer.py,112,NEEDS_ATTENTION,2,3,"Determine if BoundedBuffer is needed for upcoming batch exporters. If so, document the intended use case. If not, delete per the No Legacy Code pol..."
src/elspeth/telemetry/filtering.py,73,NEEDS_ATTENTION,2,2,"Add `FieldResolutionApplied` to the lifecycle events match case and import it from `telemetry/events`. Consider whether the fail-open wildcard defa..."
src/elspeth/telemetry/exporters/azure_monitor.py,396,SOUND,4,4,"(1) Extract `_serialize_event_attributes` into a shared utility module (alongside the already-shared `_derive_trace_id`, `_derive_span_id`, and `_S..."
src/elspeth/contracts/config/alignment.py,170,SOUND,3,0,"1. Add `""RuntimeTelemetryConfig"": ""telemetry""` to `RUNTIME_TO_SUBSYSTEM` to close the safety net gap, even though there are no active violation..."
src/elspeth/contracts/config/defaults.py,98,SOUND,3,0,"1. Remove the stale comment about duplication from engine/retry.py (lines 57-58)."
src/elspeth/contracts/events.py,194,SOUND,3,4,"Consider adding a `__post_init__` to `TelemetryEvent` that validates `timestamp` is timezone-aware (or documents that naive datetimes are acceptabl..."
src/elspeth/contracts/schema.py,471,SOUND,3,4,"No immediate changes required. Consider tightening the empty-list handling in `_parse_field_names_list` and adding a guard for non-list `fields` va..."
src/elspeth/core/landscape/_database_ops.py,57,SOUND,3,3,"No immediate changes required. The per-operation transaction granularity is a known design trade-off that is acceptable for RC-2. Consider document..."
src/elspeth/core/rate_limit/registry.py,127,SOUND,3,3,"Minor improvements: (1) Extract the close-and-clear logic to avoid duplication between `close()` and `reset_all()`. (2) Consider adding a Protocol ..."
src/elspeth/core/templates.py,233,SOUND,3,5,"No changes required. Consider adding a comment about the unsandboxed Environment choice (explaining that parse-only is safe) to prevent future conf..."
src/elspeth/engine/triggers.py,301,SOUND,3,4,"The condition evaluation duplication between `record_accept()` and `should_trigger()` is the most notable concern but is intentional and documented..."
src/elspeth/plugins/batching/row_reorder_buffer.py,369,SOUND,3,5,"Consider constraining the generic type `T` to exclude `None` (e.g., via a bound or documented precondition) to align the invariant check with the t..."
src/elspeth/plugins/sources/field_normalization.py,253,SOUND,3,6,"The soft keyword gap (Warning 1) should be addressed for completeness -- adding `keyword.issoftkeyword()` check (Python 3.12+) or a hardcoded set o..."
src/elspeth/plugins/transforms/field_mapper.py,157,SOUND,3,5,"No changes required. Minor documentation improvement for nested field behavior would help users. The deepcopy performance characteristic is worth n..."
src/elspeth/tui/widgets/node_detail.py,234,SOUND,3,6,"(1) Consider adding an explicit discriminator field to error JSON in the contracts layer rather than relying on key-presence heuristics. (2) Minor:..."
src/elspeth/contracts/__init__.py,373,SOUND,2,1,"No changes required. Consider adding a comment explaining why `AuditIntegrityError` and `OrchestrationInvariantError` are excluded from re-export f..."
src/elspeth/contracts/config/protocols.py,184,SOUND,2,0,"Consider expanding `RuntimeRateLimitProtocol` to include `get_service_config()` method signature, as the current protocol does not capture the actu..."
src/elspeth/contracts/contract_builder.py,100,SOUND,2,4,"Consider adding a debug log or assertion when the reverse mapping in line 76 would produce collisions (len(field_resolution) != len(normalized_to_o..."
src/elspeth/contracts/header_modes.py,107,SOUND,2,3,"Consider adding a log warning in the ORIGINAL mode fallback path (line 97) when `get_field()` returns `None`. This would make silent header degrada..."
src/elspeth/contracts/routing.py,172,SOUND,2,5,"Consider narrowing the `route()` method's `mode` parameter to accept only `RoutingMode.MOVE` (via a `Literal[RoutingMode.MOVE]` type annotation or ..."
src/elspeth/core/events.py,111,SOUND,2,2,"No changes required. The thread-safety note should be documented if EventBus usage ever moves to multi-threaded contexts. The lack of `unsubscribe(..."
src/elspeth/core/logging.py,154,SOUND,2,4,"Consider adding validation of the `level` parameter to reject non-standard log level strings. The handler replacement pattern is acceptable for the..."
src/elspeth/core/operations.py,181,SOUND,2,4,"Document the double-BaseException edge case (line 161's `except Exception` not catching `BaseException`). This is extremely unlikely but worth a co..."
src/elspeth/core/security/fingerprint.py,88,SOUND,2,4,"Consider adding a minimum key length warning (not enforcement, to avoid breaking existing deployments during RC) that logs a warning if the fingerp..."
src/elspeth/engine/orchestrator/types.py,130,SOUND,2,5,"No changes required. The module is clean, focused, and correctly structured as a leaf module. The mutable dict in frozen dataclass is a theoretical..."
src/elspeth/engine/orchestrator/validation.py,174,SOUND,2,3,"No immediate changes required. The module fulfills its purpose well. Consider adding a more descriptive error if `node_id_to_gate_name` lookup fail..."
src/elspeth/engine/spans.py,298,SOUND,2,4,"(1) Standardize truthiness checks to use `is not None` consistently for all optional string parameters, matching the `token_id` pattern. This is a ..."
src/elspeth/plugins/clients/base.py,107,SOUND,2,2,"Consider adding a configurable timeout to `_acquire_rate_limit()` to prevent indefinite blocking. Align `limiter` parameter types in subclasses wit..."
src/elspeth/plugins/llm/templates.py,246,SOUND,2,6,"Minor improvements: (1) Consider adding a guard on `fc.python_type.__name__` to handle edge-case types gracefully, or document the constraint that ..."
src/elspeth/plugins/llm/tracing.py,169,SOUND,2,5,"(1) Consider adding a check in `parse_tracing_config` to warn about unrecognized keys in the config dict. This could be done by comparing `config.k..."
src/elspeth/plugins/pooling/config.py,50,SOUND,2,4,"Consider adding a validator or at minimum documentation warning about `recovery_step_ms: 0` disabling recovery. Consider whether the 1-hour default..."
src/elspeth/plugins/pooling/errors.py,57,SOUND,2,3,"No immediate changes needed. When adding new cloud provider integrations, review `CAPACITY_ERROR_CODES` for completeness. Consider documenting the ..."
src/elspeth/plugins/pooling/reorder_buffer.py,162,SOUND,2,3,"Consider resetting buffer indices between batches (add a `reset()` method called from `_execute_batch_locked`), but this is low priority since the ..."
src/elspeth/plugins/pooling/throttle.py,155,SOUND,2,3,"When fixing the P2 stats accumulation bug, consider whether `reset_stats()` should set `_peak_delay_ms` to 0 rather than `_current_delay_ms`. Also ..."
src/elspeth/plugins/schema_factory.py,151,SOUND,2,5,"No urgent changes needed. Consider whether `""any""` typed fields should be documented more prominently as a deliberate opt-out of type validation,..."
src/elspeth/plugins/transforms/truncate.py,158,SOUND,2,4,"Consider building `fields_modified` during the main loop to eliminate logic duplication. The strict-mode-vs-isinstance inconsistency is a design de..."
src/elspeth/telemetry/events.py,175,SOUND,2,2,"No immediate action required. Consider adding `FieldResolutionApplied` to the explicit lifecycle match case in `filtering.py` for clarity and forwa..."
src/elspeth/telemetry/exporters/console.py,242,SOUND,2,5,"Minor improvements only: (1) Consider adding explicit `tuple -> list` and `dict` handling in `_serialize_event` for consistency with sibling export..."
src/elspeth/telemetry/protocols.py,97,SOUND,2,2,"Update the `export()` docstring to reflect reality: the method SHOULD NOT raise, but TelemetryManager will isolate failures if it does. Consider do..."
src/elspeth/testing/chaosllm/latency_simulator.py,79,SOUND,2,2,"Consider removing `simulate_slow_response()` if it is confirmed dead code, or document why it exists. The thread-safety claim in the docstring shou..."
src/elspeth/tui/types.py,143,SOUND,2,3,"Consider using `Required[]` annotations on `NodeStateInfo` for the three always-present fields (Python 3.11+ feature). Document the semantics of `T..."
src/elspeth/contracts/schema_contract_factory.py,99,SOUND,1,5,"The reverse mapping collision (W1) should be addressed with either a validation check (assert bijectivity) or a documented precondition. The dateti..."
src/elspeth/core/security/__init__.py,53,SOUND,1,1,"No changes needed. The module is a clean re-export with complete `__all__`. The only potential improvement would be lazy imports (using `__getattr_..."
src/elspeth/engine/clock.py,111,SOUND,1,5,"Consider adding a guard to `MockClock.set()` that warns or raises if the new value is less than the current value, or document more prominently tha..."
src/elspeth/plugins/batching/ports.py,83,SOUND,1,4,"Consider adding a threading.Lock to `CollectorOutputPort` for future-proofing against free-threaded Python, or document the CPython GIL dependency ..."
src/elspeth/plugins/transforms/passthrough.py,95,SOUND,1,3,"No changes required. The validation-gating observation is a systemic pattern, not a local issue."
src/elspeth/contracts/config/__init__.py,114,SOUND,0,0,"None. This file is well-structured and complete. The only potential improvement would be adding `RUNTIME_TO_SUBSYSTEM` to the re-exports if it beco..."
src/elspeth/contracts/sink.py,85,SOUND,0,4,"No changes needed. This file is clean, minimal, and well-tested through its consumers (csv_sink, json_sink, database_sink all extensively use both ..."
src/elspeth/core/checkpoint/compatibility.py,123,SOUND,0,6,"Minor cleanup would improve the module: remove the unused logger, consider inlining the delegation method, and add structural diff information to t..."
src/elspeth/core/landscape/_helpers.py,42,SOUND,0,4,"Consider removing `coerce_enum` if it is confirmed to be unused in production. If kept, add a comment indicating it is a utility for future use or ..."
src/elspeth/core/landscape/row_data.py,61,SOUND,0,4,"No changes needed. This module is well-designed, minimal, and correct."
src/elspeth/plugins/sources/null_source.py,78,SOUND,0,7,"No changes needed. This is a minimal, correctly implemented placeholder. The code is clean, well-documented, and serves its specific purpose. The o..."
