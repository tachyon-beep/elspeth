# Testing Coverage Overview

| Area | Key Tests | Focus |
| --- | --- | --- |
| Configuration Validation | `tests/test_config.py`, `tests/test_validation_settings.py`, `tests/test_config_suite.py` | Ensures schema enforcement catches missing plugins, bad options, and suite-level inconsistencies before runtime (`src/elspeth/core/validation/settings.py and src/elspeth/core/validation/suite.py`) |
| Datasource Security | `tests/test_datasource_csv.py`, `tests/test_datasource_blob_plugin.py` | Confirms `on_error` policies, security-level tagging, and blob profile resolution behave deterministically (`src/elspeth/plugins/datasources/csv_blob.py:35`) |
| Middleware Enforcement | `tests/test_llm_middleware.py:39-199` | Verifies chaining, prompt shielding (abort/mask/log), Azure Content Safety screening, and telemetry channel logging |
| LLM Client Adapters | `tests/test_llm_azure.py`, `tests/test_llm_http_openai.py`, `tests/test_llm_mock.py` | Mocks external APIs to validate credential resolution, request payloads, and deterministic mock behaviour (`src/elspeth/plugins/llms/azure_openai.py:25`) |
| Output Sanitisation | `tests/test_sanitize_utils.py:6-43`, `tests/test_outputs_csv.py`, `tests/test_outputs_local_bundle.py` | Guards spreadsheet formula injection and ensures sanitiser metadata is preserved (`src/elspeth/plugins/outputs/_sanitize.py:18`, `src/elspeth/plugins/outputs/csv_file.py:59`) |
| Signed Artifacts & Repositories | `tests/test_outputs_signed.py:21-78`, `tests/test_outputs_repo.py` | Validates signature generation, legacy env fallbacks, skip-on-error behaviour, and dry-run payload creation (`src/elspeth/plugins/outputs/signed.py:48`, `src/elspeth/plugins/outputs/repository.py:135`) |
| Artifact Pipeline | `tests/test_artifact_pipeline.py`, `tests/test_sink_chaining.py`, `tests/test_registry_artifacts.py` | Exercises dependency ordering, security-level enforcement, and descriptor validation (`src/elspeth/core/pipeline/artifact_pipeline.py:192`) |
| Experiment Runner | `tests/test_experiments.py`, `tests/test_suite_runner_integration.py:41-154`, `tests/test_orchestrator.py` | Covers prompt compilation, retry metadata, plugin instantiation, suite defaults merging, and manifest production (`src/elspeth/core/experiments/runner.py:65`, `src/elspeth/core/experiments/suite_runner.py:86`) |
| Validation Plugins | `tests/test_validation_plugins.py`, `tests/test_prompt_variants_plugin.py`, `tests/test_experiment_metrics_plugins.py` | Exercises regex/JSON/LLM guard, prompt variants, and statistical aggregators for compliance with schema and expected semantics (`src/elspeth/plugins/experiments/validation.py:20`, `src/elspeth/plugins/experiments/metrics.py:37`) |
| Security Utilities | `tests/test_security_signing.py`, `tests/test_processing.py`, `tests/test_artifacts.py` | Validates signing helpers, prompt context preparation, and artifact type validation (`src/elspeth/core/security/signing.py:17`, `src/elspeth/core/pipeline/artifacts.py:10`) |

**Coverage instrumentation** â€“ The pytest configuration emits XML coverage reports for Sonar ingestion (`pyproject.toml:65`). The bootstrap script runs the full suite in CI-like conditions (`scripts/bootstrap.sh:16`), ensuring regressions in security-critical paths are detected early.
